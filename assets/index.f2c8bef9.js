var je=Object.defineProperty,Xe=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var Re=(t,e,n)=>e in t?je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_e=(t,e)=>{for(var n in e||(e={}))ze.call(e,n)&&Re(t,n,e[n]);if(ce)for(var n of ce(e))De.call(e,n)&&Re(t,n,e[n]);return t},be=(t,e)=>Xe(t,xe(e));var ge=(t,e)=>{var n={};for(var i in t)ze.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&ce)for(var i of ce(t))e.indexOf(i)<0&&De.call(t,i)&&(n[i]=t[i]);return n};import{S as Y,i as Z,s as J,e as m,t as A,a as v,b as u,c as G,d as T,f as h,n as C,l as U,g as S,h as F,j as et,r as ae,k as tt,m as ee,w as fe,o as nt,p as he,q as ve,N as Te,U as it,u as ot,v as Se,D as Ie,E as rt,x as Me,y as Ge,z as Q,A as pe,B as lt,G as st,L as q,C as Ye,F as Ee,H as me,I as R,J as j,K as X,M as E,O as x,P as ne,Q as ie,R as at,T as ct,V as ut,W as oe,X as dt,Y as ft,Z as pt,_ as mt,$ as _t,a0 as le,a1 as bt,a2 as gt,a3 as ht}from"./vendor.20d980e1.js";const wt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};wt();function Ne(t){let e,n,i;return{c(){e=m("ion-item"),n=m("ion-label"),i=A(t[1])},m(o,r){v(o,e,r),u(e,n),u(n,i)},p(o,r){r&2&&G(i,o[1])},d(o){o&&T(e)}}}function Ue(t){let e,n;return{c(){e=m("ion-item"),n=m("ion-input"),h(n,"placeholder","Full Name"),h(n,"type","text"),h(n,"required","")},m(i,o){v(i,e,o),u(e,n),t[8](n)},p:C,d(i){i&&T(e),t[8](null)}}}function Fe(t){let e,n,i,o;return{c(){e=m("ion-item"),n=m("ion-input"),h(n,"placeholder","confirm password"),h(n,"type","password"),h(n,"required","")},m(r,l){v(r,e,l),u(e,n),t[11](n),i||(o=U(n,"keypress",t[7]),i=!0)},p:C,d(r){r&&T(e),t[11](null),i=!1,o()}}}function yt(t){let e,n,i,o=t[0]?"Sign up":"Login",r,l,a,c,s,d,b,y,w,f,g,p,_,z,k,M=t[0]?"Sign up":"Login",L,I,D,B=t[0]?"Login instead":"Sign up instead",P,V,Ce,$=t[1]!==""&&Ne(t),H=t[0]&&Ue(t),O=t[0]&&Fe(t);return{c(){e=m("ion-header"),n=m("ion-toolbar"),i=m("ion-title"),r=A(o),l=S(),a=m("ion-icon"),c=S(),s=m("ion-list"),$&&$.c(),d=S(),H&&H.c(),b=S(),y=m("ion-item"),w=m("ion-input"),f=S(),g=m("ion-item"),p=m("ion-input"),_=S(),O&&O.c(),z=S(),k=m("ion-button"),L=A(M),I=S(),D=m("ion-button"),P=A(B),h(e,"translucent",""),F(a,"position","fixed"),F(a,"left","calc(50% - 64px)"),F(a,"margin-right","auto"),F(a,"top","15%"),F(a,"font-size","128px"),F(a,"color","lightgray"),h(a,"name","bicycle"),h(w,"placeholder","email"),h(w,"type","text"),h(w,"required",""),h(w,"autofocus",""),h(p,"placeholder","password"),h(p,"type","password"),h(p,"required",""),h(k,"expand","block"),h(s,"lines","full")},m(N,W){v(N,e,W),u(e,n),u(n,i),u(i,r),v(N,l,W),v(N,a,W),v(N,c,W),v(N,s,W),$&&$.m(s,null),u(s,d),H&&H.m(s,null),u(s,b),u(s,y),u(y,w),t[9](w),u(s,f),u(s,g),u(g,p),t[10](p),u(s,_),O&&O.m(s,null),u(s,z),u(s,k),u(k,L),v(N,I,W),v(N,D,W),u(D,P),w.focus(),V||(Ce=[U(p,"keypress",function(){et(t[0]?void 0:t[7])&&(t[0]?void 0:t[7]).apply(this,arguments)}),U(k,"click",t[6]),U(D,"click",t[12])],V=!0)},p(N,[W]){t=N,W&1&&o!==(o=t[0]?"Sign up":"Login")&&G(r,o),t[1]!==""?$?$.p(t,W):($=Ne(t),$.c(),$.m(s,d)):$&&($.d(1),$=null),t[0]?H?H.p(t,W):(H=Ue(t),H.c(),H.m(s,b)):H&&(H.d(1),H=null),t[0]?O?O.p(t,W):(O=Fe(t),O.c(),O.m(s,z)):O&&(O.d(1),O=null),W&1&&M!==(M=t[0]?"Sign up":"Login")&&G(L,M),W&1&&B!==(B=t[0]?"Login instead":"Sign up instead")&&G(P,B)},i:C,o:C,d(N){N&&T(e),N&&T(l),N&&T(a),N&&T(c),N&&T(s),$&&$.d(),H&&H.d(),t[9](null),t[10](null),O&&O.d(),N&&T(I),N&&T(D),V=!1,ae(Ce)}}}function kt(t,e,n){const i=tt();function o(){!c||!s||r&&!d||i("submit",{name:a?a.value:void 0,email:c.value,password:s.value,confirmPassword:d?d.value:void 0,signup:r})}let{signup:r=!1}=e,{errorNote:l=""}=e,a,c,s,d;function b(_){_.key==="Enter"&&o()}function y(_){ee[_?"unshift":"push"](()=>{a=_,n(2,a)})}function w(_){ee[_?"unshift":"push"](()=>{c=_,n(3,c)})}function f(_){ee[_?"unshift":"push"](()=>{s=_,n(4,s)})}function g(_){ee[_?"unshift":"push"](()=>{d=_,n(5,d)})}const p=()=>n(0,r=!r);return t.$$set=_=>{"signup"in _&&n(0,r=_.signup),"errorNote"in _&&n(1,l=_.errorNote)},[r,l,a,c,s,d,o,b,y,w,f,g,p]}class vt extends Y{constructor(e){super();Z(this,e,kt,yt,J,{signup:0,errorNote:1})}}const Tt=(t,e)=>{const n=localStorage.getItem(t),i=fe(n?JSON.parse(n):e);return i.subscribe(o=>localStorage.setItem(t,o?JSON.stringify(o):"")),i},ue=fe(!1),K=fe(null),we=fe(null),de=Tt("currentTrip",null),St=t=>{de.update(e=>e?(e.geopoints=[...e.geopoints,{timestamp:new Date().toISOString(),location:t}],e):null)},ye=t=>{if(!t.length)return 0;let e=0;for(let n=1;n<t.length-1;++n)e+=nt(t[n-1].location,t[n].location);return e},It=t=>{let e=t.geopoints.map(n=>({latitude:n.location.latitude,longitude:n.location.longitude})).reduce((n,i)=>({latitude:n.latitude+i.latitude,longitude:i.longitude+n.longitude}));return e.latitude/=t.geopoints.length,e.longitude/=t.geopoints.length,e},Mt={toFirestore:t=>({name:t.name,email:t.email,credits:t.credits,redeemedRewards:t.redeemedRewards}),fromFirestore:(t,e)=>{const n=t.data(e);return{name:n.name,email:n.email,credits:n.credits,redeemedRewards:n.redeemedRewards}}},Le={toFirestore:t=>({id:t.id,userEmail:t.userEmail,startTime:he.fromDate(t.startTime),endTime:t.endTime?he.fromDate(t.endTime):null,transportType:t.transportType,distance:t.distance,geopoints:t.geopoints}),fromFirestore:(t,e)=>{const n=t.data(e);return{id:n.id,userEmail:n.userEmail,startTime:n.startTime.toDate(),endTime:n.endTime?n.endTime.toDate():null,transportType:n.transportType,distance:n.distance,geopoints:n.geopoints}}},Ze={toFirestore:t=>({id:t.id,name:t.name,description:t.description,price:t.price,provider:t.provider,expiration:he.fromDate(t.expiration),remainingUnits:t.remainingUnits}),fromFirestore:(t,e)=>{const n=t.data(e);return{id:n.id,name:n.name,description:n.description,price:n.price,provider:n.provider,expiration:n.expiration.toDate(),remainingUnits:n.remainingUnits}}},re=()=>it(),Je=t=>Te(re(),"users",t).withConverter(Mt),Lt=t=>Te(re(),"trips",t.id).withConverter(Le),Ct=t=>Te(re(),"rewards",t.id).withConverter(Ze),Rt=async t=>{const o=t,{redeemedRewards:e}=o,n=ge(o,["redeemedRewards"]),i=be(_e({},n),{redeemedRewards:e.map(r=>r.id)});await ve(Je(t.email),i)},zt=async t=>{await ve(Lt(t),t)},Dt=async t=>{await ve(Ct(t),t)},Et=async t=>{const e=await ot(Je(t));if(!e.exists())return null;const n=e.data(),a=n,{redeemedRewards:i}=a,o=ge(a,["redeemedRewards"]),r=await Nt(n.email),l=(await Ke()).filter(c=>(i||[]).includes(c.id));return be(_e({},o),{trips:r,redeemedRewards:l})},Nt=async t=>{const e=[];return(await Se(Ie(re(),"trips").withConverter(Le))).forEach(i=>i.exists()&&e.push(i.data())),e.filter(i=>i.userEmail===t)},Ut=async t=>{(await Se(Ie(re(),"trips").withConverter(Le))).forEach(n=>{n.exists()&&n.data().id===t&&rt(n.ref)})},Ke=async()=>{const t=[];return(await Se(Ie(re(),"rewards").withConverter(Ze))).forEach(n=>n.exists()&&t.push(n.data())),t};var te={fetchUser:Et,fetchAllRewards:Ke,updateUser:Rt,updateTrip:zt,updateReward:Dt,deleteTrip:Ut};function ke(t){switch(t){case"bicycle":return"bicycle";case"walk":return"walk";case"publicTransport":return"bus";default:return"walk"}}const{window:Ft}=lt;function Pe(t,e,n){const i=t.slice();return i[16]=e[n],i}function Pt(t){let e,n,i,o,r=t[5],l=[];for(let a=0;a<r.length;a+=1)l[a]=$e(Pe(t,r,a));return{c(){e=m("ion-fab"),n=m("ion-fab-button"),n.innerHTML='<ion-icon name="add"></ion-icon>',i=S(),o=m("ion-fab-list");for(let a=0;a<l.length;a+=1)l[a].c();h(o,"side","top"),h(e,"horizontal","center"),h(e,"vertical","bottom"),h(e,"slot","fixed")},m(a,c){v(a,e,c),u(e,n),u(e,i),u(e,o);for(let s=0;s<l.length;s+=1)l[s].m(o,null)},p(a,c){if(c&48){r=a[5];let s;for(s=0;s<r.length;s+=1){const d=Pe(a,r,s);l[s]?l[s].p(d,c):(l[s]=$e(d),l[s].c(),l[s].m(o,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=r.length}},d(a){a&&T(e),Ye(l,a)}}}function $t(t){let e,n,i;return{c(){e=m("ion-fab"),e.innerHTML='<ion-fab-button><ion-icon name="close"></ion-icon></ion-fab-button>',h(e,"horizontal","center"),h(e,"vertical","bottom"),h(e,"slot","fixed")},m(o,r){v(o,e,r),n||(i=U(e,"click",t[3]),n=!0)},p:C,d(o){o&&T(e),n=!1,i()}}}function $e(t){let e,n,i,o,r,l;function a(){return t[6](t[16])}return{c(){e=m("ion-fab-button"),n=m("ion-icon"),o=S(),h(n,"name",i=ke(t[16]))},m(c,s){v(c,e,s),u(e,n),u(e,o),r||(l=U(e,"click",a),r=!0)},p(c,s){t=c},d(c){c&&T(e),r=!1,l()}}}function Ht(t){let e,n,i,o,r;function l(s,d){return s[0]?$t:Pt}let a=l(t),c=a(t);return{c(){e=m("ion-content"),c.c(),n=S(),i=m("div"),Me(i,"class","map svelte-vsoji2"),F(i,"height","100%"),F(i,"width","100%")},m(s,d){v(s,e,d),c.m(e,null),u(e,n),u(e,i),o||(r=[U(Ft,"resize",t[2]),Ge(t[1].call(null,i))],o=!0)},p(s,[d]){a===(a=l(s))&&c?c.p(s,d):(c.d(1),c=a(s),c&&(c.c(),c.m(e,n)))},i:C,o:C,d(s){s&&T(e),c.d(),o=!1,ae(r)}}}function Ot(t,e,n){let i,o;Q(t,de,k=>n(0,i=k)),Q(t,K,k=>n(12,o=k));let r=null,l=null,a=null,c=null;const s=async()=>{const k=await st.getCurrentPosition();return{lat:k.coords.latitude,lng:k.coords.longitude}},d=k=>(r=q.map(k,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(r),r.setView([45.504755,-73.612572],14),{destroy:()=>{r==null||r.remove(),r=null}}),b=()=>r==null?void 0:r.invalidateSize(),y=async k=>{!r||(a==null||a.removeFrom(r),l==null||l.removeFrom(r),c=q.circleMarker(k,{color:"red",weight:2,opacity:.7}),a=q.circleMarker(k,{color:"red",weight:2,opacity:.7}),l=q.polyline([k],{color:"red",weight:3,opacity:.5,smoothFactor:1}),c.addTo(r),a.addTo(r),l.addTo(r))},w=()=>{if(!r||!(i==null?void 0:i.geopoints.length))return;const k=i.geopoints.sort((M,L)=>M.timestamp<L.timestamp?-1:1).map(M=>[M.location.latitude,M.location.longitude]);a=q.circleMarker(k[0],{color:"red",weight:2,opacity:.7}),c=q.circleMarker(k[k.length-1],{color:"red",weight:2,opacity:.7}),l=q.polyline(k,{color:"red",weight:3,opacity:.5,smoothFactor:1}),a.addTo(r),c.addTo(r),l.addTo(r)};let f=null;const g=()=>{if(f&&(clearInterval(f),f=null),!i)return;const k=ye(i.geopoints),M={id:i.id,userEmail:i.userEmail,transportType:i.transportType,startTime:new Date(i.startTime),endTime:new Date,distance:k,geopoints:i.geopoints.map(({location:L,timestamp:I})=>({location:L,timestamp:I}))};te.updateTrip(M),de.set(null),r&&(l==null||l.removeFrom(r),a==null||a.removeFrom(r),c==null||c.removeFrom(r)),K.update(L=>L?(L.credits+=Math.floor(.28*k/1e3),L.trips=[...L.trips,M],L):null)},p=async k=>{de.set({id:Date.now().toString(),userEmail:o.email,startTime:new Date().toISOString(),transportType:k,geopoints:[]});const M=await s();y(M),f=window.setInterval(async()=>{if(!i)return;const L=await s();St({latitude:L.lat,longitude:L.lng}),i.geopoints.length==0?y(L):l==null||l.addLatLng(L)},3e3)};return pe(()=>{setTimeout(async()=>{const k=await s();r==null||r.setView(k),(i==null?void 0:i.geopoints.length)&&w(),b()},300)}),[i,d,b,g,p,["publicTransport","walk","bicycle"],k=>p(k)]}class Wt extends Y{constructor(e){super();Z(this,e,Ot,Ht,J,{})}}function At(t){let e,n,i,o=t[0].name+"",r,l,a,c=t[0].description+"",s,d,b,y,w=t[0].price+"",f,g,p,_,z,k,M=t[0].expiration?`Expires on ${t[0].expiration.toDateString()}`:"",L,I,D,B;return{c(){e=m("ion-card"),n=m("ion-card-header"),i=m("ion-card-title"),r=A(o),l=S(),a=m("ion-card-subtitle"),s=A(c),d=S(),b=m("ion-card-content"),y=A("Cost: "),f=A(w),g=S(),p=m("ion-icon"),_=S(),z=m("br"),k=S(),L=A(M),h(a,"class","sub svelte-aab9bb"),F(p,"color","green"),F(p,"font-size","16px"),F(p,"padding-left","3px"),h(p,"name","leaf-outline"),h(b,"class","content svelte-aab9bb"),h(e,"class",I=Ee(t[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")},m(P,V){v(P,e,V),u(e,n),u(n,i),u(i,r),u(n,l),u(n,a),u(a,s),u(e,d),u(e,b),u(b,y),u(b,f),u(b,g),u(b,p),u(b,_),u(b,z),u(b,k),u(b,L),D||(B=U(e,"click",t[3]),D=!0)},p(P,[V]){V&1&&o!==(o=P[0].name+"")&&G(r,o),V&1&&c!==(c=P[0].description+"")&&G(s,c),V&1&&w!==(w=P[0].price+"")&&G(f,w),V&1&&M!==(M=P[0].expiration?`Expires on ${P[0].expiration.toDateString()}`:"")&&G(L,M),V&2&&I!==(I=Ee(P[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")&&h(e,"class",I)},i:C,o:C,d(P){P&&T(e),D=!1,B()}}}function qt(t,e,n){let i;Q(t,K,s=>n(4,i=s));let{reward:o}=e,r=(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1;function l(){!i||a()||!o.remainingUnits||i.credits<o.price||(K.update(s=>s&&(n(1,r=!0),s.credits-=o.price,s.redeemedRewards=[...s.redeemedRewards,o],s)),n(0,o.remainingUnits--,o))}function a(){return(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1}const c=()=>l();return t.$$set=s=>{"reward"in s&&n(0,o=s.reward)},[o,r,l,c]}class Bt extends Y{constructor(e){super();Z(this,e,qt,At,J,{reward:0})}}function He(t,e,n){const i=t.slice();return i[2]=e[n],i}function Oe(t){let e,n,i=t[1],o=[];for(let l=0;l<i.length;l+=1)o[l]=We(He(t,i,l));const r=l=>E(o[l],1,1,()=>{o[l]=null});return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=me()},m(l,a){for(let c=0;c<o.length;c+=1)o[c].m(l,a);v(l,e,a),n=!0},p(l,a){if(a&2){i=l[1];let c;for(c=0;c<i.length;c+=1){const s=He(l,i,c);o[c]?(o[c].p(s,a),R(o[c],1)):(o[c]=We(s),o[c].c(),R(o[c],1),o[c].m(e.parentNode,e))}for(ne(),c=i.length;c<o.length;c+=1)r(c);ie()}},i(l){if(!n){for(let a=0;a<i.length;a+=1)R(o[a]);n=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)E(o[a]);n=!1},d(l){Ye(o,l),l&&T(e)}}}function We(t){let e,n;return e=new Bt({props:{reward:t[2]}}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),n=!0},p(i,o){const r={};o&2&&(r.reward=i[2]),e.$set(r)},i(i){n||(R(e.$$.fragment,i),n=!0)},o(i){E(e.$$.fragment,i),n=!1},d(i){x(e,i)}}}function Vt(t){var g;let e,n,i,o,r,l,a,c=((g=t[0])==null?void 0:g.credits)+"",s,d,b,y,w,f=t[1]&&Oe(t);return{c(){e=m("ion-header"),e.innerHTML="<ion-toolbar><ion-title>Rewards</ion-title></ion-toolbar>",n=S(),i=m("ion-content"),o=m("ion-list"),r=m("ion-list-header"),l=m("h2"),a=A("You have "),s=A(c),d=S(),b=m("ion-icon"),y=S(),f&&f.c(),h(e,"translucent",""),F(b,"color","green"),F(b,"font-size","32px"),F(b,"padding-left","3px"),h(b,"name","leaf-outline")},m(p,_){v(p,e,_),v(p,n,_),v(p,i,_),u(i,o),u(o,r),u(r,l),u(l,a),u(l,s),u(r,d),u(r,b),u(o,y),f&&f.m(o,null),w=!0},p(p,[_]){var z;(!w||_&1)&&c!==(c=((z=p[0])==null?void 0:z.credits)+"")&&G(s,c),p[1]?f?(f.p(p,_),_&2&&R(f,1)):(f=Oe(p),f.c(),R(f,1),f.m(o,null)):f&&(ne(),E(f,1,1,()=>{f=null}),ie())},i(p){w||(R(f),w=!0)},o(p){E(f),w=!1},d(p){p&&T(e),p&&T(n),p&&T(i),f&&f.d()}}}function Gt(t,e,n){let i,o;return Q(t,K,r=>n(0,i=r)),Q(t,we,r=>n(1,o=r)),[i,o]}class Yt extends Y{constructor(e){super();Z(this,e,Gt,Vt,J,{})}}function Zt(t){let e,n,i,o,r,l,a,c;return{c(){e=m("ion-list"),n=m("ion-item"),n.innerHTML=`Logout
        <ion-icon name="log-out-outline" slot="end"></ion-icon>`,i=S(),o=m("ion-item"),o.innerHTML=`about
        <ion-icon name="information-circle-outline" slot="end"></ion-icon>`,r=S(),l=m("ion-item"),l.innerHTML=`GitHub Repo
        <ion-icon name="logo-github" slot="end"></ion-icon>`,h(n,"button",""),h(o,"button",""),h(l,"lines","none"),h(l,"button",""),h(e,"lines","n")},m(s,d){v(s,e,d),u(e,n),u(e,i),u(e,o),u(e,r),u(e,l),a||(c=[U(n,"click",t[1]),U(o,"click",t[2]),U(l,"click",t[3])],a=!0)},p:C,i:C,o:C,d(s){s&&T(e),a=!1,ae(c)}}}function Jt(t){let e=document.querySelector("ion-popover");const n=l=>{e==null||e.dismiss(l)};return[n,()=>{n("logout")},()=>{n("about")},()=>{n("github")}]}class Kt extends Y{constructor(e){super();Z(this,e,Jt,Zt,J,{})}}const Qt=function(t){return document.createElement(t).constructor!==HTMLElement},Qe=(t,e)=>{Qt(t)||ct(t,e,[])},jt=(t,e,n)=>(Qe(t,e),ut.create({component:t,componentProps:n}).then(i=>(i.present(),i.onWillDismiss()))),Xt=(t,e,n,i)=>(Qe(e,n),at.create({component:e,event:t,componentProps:i}).then(o=>(o.present(),o.onWillDismiss()))),xt=()=>!!oe().currentUser,en=()=>{var t;return((t=oe().currentUser)==null?void 0:t.email)||null},tn=async(t,e)=>{try{return await dt(oe(),t,e),!0}catch(n){return console.log("Failed to login"),console.log(n),!1}},nn=()=>oe().signOut(),on=async(t,e,n)=>{try{return await ft(oe(),e,n),await te.updateUser({email:e,name:t,credits:100,redeemedRewards:[],trips:[]}),!0}catch(i){return console.log("Failed to sign up"),console.log(i),!1}};var se={logout:nn,login:tn,getCurrentUser:en,isLoggedIn:xt,signUp:on};function rn(t){let e,n,i;return{c(){e=m("div"),Me(e,"class","map svelte-a80q7u"),F(e,"height","100%"),F(e,"width","100%")},m(o,r){v(o,e,r),n||(i=[U(window,"resize",t[1]),Ge(t[0].call(null,e))],n=!0)},p:C,i:C,o:C,d(o){o&&T(e),n=!1,ae(i)}}}function ln(t,e,n){let{trip:i}=e,o=null,r=null,l=null,a=null;const c=b=>(o=q.map(b,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(o),o.setView([45.504755,-73.612572],14),{destroy:()=>{o==null||o.remove(),o=null}}),s=()=>o==null?void 0:o.invalidateSize(),d=()=>{if(!o)return;const b=i.geopoints.sort((y,w)=>y.timestamp<w.timestamp?-1:1).map(y=>[y.location.latitude,y.location.longitude]);l=q.circleMarker(b[0],{color:"red",weight:2,opacity:.7}),a=q.circleMarker(b[b.length-1],{color:"red",weight:2,opacity:.7}),r=q.polyline(b,{color:"red",weight:3,opacity:.5,smoothFactor:1}),l.addTo(o),a.addTo(o),r.addTo(o)};return pe(()=>{setTimeout(async()=>{if(i){console.log(i);var b=It(i);o==null||o.setView([b.latitude,b.longitude]),d()}s()},300)}),t.$$set=b=>{"trip"in b&&n(2,i=b.trip)},[c,s,i]}class sn extends Y{constructor(e){super();Z(this,e,ln,rn,J,{trip:2})}}function an(t){let e,n,i,o,r,l=ye(t[0].geopoints).toLocaleString(void 0,{maximumFractionDigits:0})+" m",a,c,s,d,b,y,w;return{c(){e=m("ion-item"),n=m("ion-icon"),o=S(),r=m("ion-label"),a=A(l),c=S(),s=m("ion-button"),d=A("Delete"),h(n,"name",i=ke(t[0].transportType)),h(n,"slot","start"),s.hidden=b=!t[1]},m(f,g){v(f,e,g),u(e,n),u(e,o),u(e,r),u(r,a),u(e,c),u(e,s),u(s,d),t[6](e),y||(w=[U(r,"click",t[4]),U(s,"click",t[5])],y=!0)},p(f,[g]){g&1&&i!==(i=ke(f[0].transportType))&&h(n,"name",i),g&1&&l!==(l=ye(f[0].geopoints).toLocaleString(void 0,{maximumFractionDigits:0})+" m")&&G(a,l),g&2&&b!==(b=!f[1])&&(s.hidden=b)},i:C,o:C,d(f){f&&T(e),t[6](null),y=!1,ae(w)}}}function cn(t,e,n){let{trip:i}=e,{editable:o=!1}=e,r;function l(){te.deleteTrip(i.id)}function a(d){jt("summary-map",sn,{trip:i})}const c=()=>{var d;l(),(d=r==null?void 0:r.parentNode)==null||d.removeChild(r)};function s(d){ee[d?"unshift":"push"](()=>{r=d,n(2,r)})}return t.$$set=d=>{"trip"in d&&n(0,i=d.trip),"editable"in d&&n(1,o=d.editable)},[i,o,r,l,a,c,s]}class un extends Y{constructor(e){super();Z(this,e,cn,an,J,{trip:0,editable:1})}}function Ae(t,e,n){const i=t.slice();return i[6]=e[n],i}function dn(t){let e,n,i,o,r,l;return{c(){e=m("ion-item"),n=m("ion-label"),n.textContent="Failed to load user",i=S(),o=m("ion-button"),o.textContent="Go back to login page",h(o,"slot","end"),h(o,"fill","outline")},m(a,c){v(a,e,c),u(e,n),u(e,i),u(e,o),r||(l=U(o,"click",t[5]),r=!0)},p:C,i:C,o:C,d(a){a&&T(e),r=!1,l()}}}function fn(t){let e,n,i,o,r,l=[],a=new Map,c,s,d,b,y,w=t[1].trips;const f=p=>p[6].id;for(let p=0;p<w.length;p+=1){let _=Ae(t,w,p),z=f(_);a.set(z,l[p]=qe(z,_))}let g=!t[1].trips.length&&Be();return{c(){e=m("ion-list-header"),n=m("ion-label"),n.textContent="Trips",i=S(),o=m("ion-button"),o.textContent="Edit",r=S();for(let p=0;p<l.length;p+=1)l[p].c();c=S(),g&&g.c(),s=me()},m(p,_){v(p,e,_),u(e,n),u(e,i),u(e,o),v(p,r,_);for(let z=0;z<l.length;z+=1)l[z].m(p,_);v(p,c,_),g&&g.m(p,_),v(p,s,_),d=!0,b||(y=U(o,"click",t[4]),b=!0)},p(p,_){_&3&&(w=p[1].trips,ne(),l=mt(l,_,f,1,p,w,a,c.parentNode,_t,qe,c,Ae),ie()),p[1].trips.length?g&&(g.d(1),g=null):g||(g=Be(),g.c(),g.m(s.parentNode,s))},i(p){if(!d){for(let _=0;_<w.length;_+=1)R(l[_]);d=!0}},o(p){for(let _=0;_<l.length;_+=1)E(l[_]);d=!1},d(p){p&&T(e),p&&T(r);for(let _=0;_<l.length;_+=1)l[_].d(p);p&&T(c),g&&g.d(p),p&&T(s),b=!1,y()}}}function qe(t,e){let n,i,o;return i=new un({props:{editable:e[0],trip:e[6]}}),{key:t,first:null,c(){n=me(),j(i.$$.fragment),this.first=n},m(r,l){v(r,n,l),X(i,r,l),o=!0},p(r,l){e=r;const a={};l&1&&(a.editable=e[0]),l&2&&(a.trip=e[6]),i.$set(a)},i(r){o||(R(i.$$.fragment,r),o=!0)},o(r){E(i.$$.fragment,r),o=!1},d(r){r&&T(n),x(i,r)}}}function Be(t){let e;return{c(){e=m("ion-item"),e.innerHTML='<ion-label color="medium">You don&#39;t have any trips yets</ion-label>',h(e,"lines","none")},m(n,i){v(n,e,i)},d(n){n&&T(e)}}}function pn(t){let e,n,i,o,r,l,a=(t[1]?t[1].name:"Profile")+"",c,s,d,b,y,w,f,g,p,_,z;const k=[fn,dn],M=[];function L(I,D){return I[1]?0:1}return f=L(t),g=M[f]=k[f](t),{c(){e=m("ion-header"),n=m("ion-toolbar"),i=m("ion-buttons"),o=m("ion-button"),o.innerHTML='<ion-icon slot="icon-only" ios="ellipsis-horizontal" md="ellipsis-vertical"></ion-icon>',r=S(),l=m("ion-title"),c=A(a),s=S(),d=m("ion-content"),b=m("div"),y=S(),w=m("ion-list"),g.c(),h(i,"slot","primary"),h(e,"translucent",""),Me(b,"class","summary-map")},m(I,D){v(I,e,D),u(e,n),u(n,i),u(i,o),u(n,r),u(n,l),u(l,c),v(I,s,D),v(I,d,D),u(d,b),u(d,y),u(d,w),M[f].m(w,null),p=!0,_||(z=U(o,"click",t[2]),_=!0)},p(I,[D]){(!p||D&2)&&a!==(a=(I[1]?I[1].name:"Profile")+"")&&G(c,a);let B=f;f=L(I),f===B?M[f].p(I,D):(ne(),E(M[B],1,1,()=>{M[B]=null}),ie(),g=M[f],g?g.p(I,D):(g=M[f]=k[f](I),g.c()),R(g,1),g.m(w,null))},i(I){p||(R(g),p=!0)},o(I){E(g),p=!1},d(I){I&&T(e),I&&T(s),I&&T(d),M[f].d(),_=!1,z()}}}function mn(t,e,n){let i;Q(t,K,s=>n(1,i=s));let o=!1;function r(s){Xt(s,"popover-extra",Kt,{}).then(async d=>{switch(d.data){case"logout":await se.logout();break;case"github":await pt.open({url:"http://github.com/marr11317/bhackcycle"})}})}function l(){n(0,o=!o)}return[o,i,r,l,()=>l(),()=>se.logout()]}class _n extends Y{constructor(e){super();Z(this,e,mn,pn,J,{})}}function bn(t){let e,n,i,o,r,l,a,c,s,d,b,y,w;return o=new Wt({}),a=new Yt({}),d=new _n({}),{c(){e=m("ion-app"),n=m("ion-tabs"),i=m("ion-tab"),j(o.$$.fragment),r=S(),l=m("ion-tab"),j(a.$$.fragment),c=S(),s=m("ion-tab"),j(d.$$.fragment),b=S(),y=m("ion-tab-bar"),y.innerHTML=`<ion-tab-button tab="map"><ion-label>Map</ion-label> 
        <ion-icon name="bicycle-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="rewards"><ion-label>Rewards</ion-label> 
        <ion-icon name="trophy-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="profile"><ion-label>profile</ion-label> 
        <ion-icon name="analytics-outline"></ion-icon></ion-tab-button>`,h(i,"tab","map"),h(l,"tab","rewards"),h(s,"tab","profile"),h(y,"slot","bottom")},m(f,g){v(f,e,g),u(e,n),u(n,i),X(o,i,null),u(n,r),u(n,l),X(a,l,null),u(n,c),u(n,s),X(d,s,null),u(n,b),u(n,y),w=!0},p:C,i(f){w||(R(o.$$.fragment,f),R(a.$$.fragment,f),R(d.$$.fragment,f),w=!0)},o(f){E(o.$$.fragment,f),E(a.$$.fragment,f),E(d.$$.fragment,f),w=!1},d(f){f&&T(e),x(o),x(a),x(d)}}}function gn(t,e,n){let i,o;return Q(t,we,r=>n(0,i=r)),Q(t,K,r=>n(1,o=r)),pe(async()=>{const r=await te.fetchUser(se.getCurrentUser());le(K,o=r,o);const l=await te.fetchAllRewards();le(we,i=l,i)}),K.subscribe(async r=>{r&&await te.updateUser(r)}),[]}class hn extends Y{constructor(e){super();Z(this,e,gn,bn,J,{})}}function Ve(t){let e,n,i,o;const r=[yn,wn],l=[];function a(c,s){return c[3]?1:0}return e=a(t),n=l[e]=r[e](t),{c(){n.c(),i=me()},m(c,s){l[e].m(c,s),v(c,i,s),o=!0},p(c,s){let d=e;e=a(c),e===d?l[e].p(c,s):(ne(),E(l[d],1,1,()=>{l[d]=null}),ie(),n=l[e],n?n.p(c,s):(n=l[e]=r[e](c),n.c()),R(n,1),n.m(i.parentNode,i))},i(c){o||(R(n),o=!0)},o(c){E(n),o=!1},d(c){l[e].d(c),c&&T(i)}}}function wn(t){let e,n;return e=new hn({}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),n=!0},p:C,i(i){n||(R(e.$$.fragment,i),n=!0)},o(i){E(e.$$.fragment,i),n=!1},d(i){x(e,i)}}}function yn(t){let e,n,i;function o(l){t[5](l)}let r={errorNote:t[2]};return t[1]!==void 0&&(r.signup=t[1]),e=new vt({props:r}),ee.push(()=>bt(e,"signup",o)),e.$on("submit",t[4]),{c(){j(e.$$.fragment)},m(l,a){X(e,l,a),i=!0},p(l,a){const c={};a&4&&(c.errorNote=l[2]),!n&&a&2&&(n=!0,c.signup=l[1],gt(()=>n=!1)),e.$set(c)},i(l){i||(R(e.$$.fragment,l),i=!0)},o(l){E(e.$$.fragment,l),i=!1},d(l){x(e,l)}}}function kn(t){let e,n,i=t[0]&&Ve(t);return{c(){e=m("ion-app"),i&&i.c()},m(o,r){v(o,e,r),i&&i.m(e,null),n=!0},p(o,[r]){o[0]?i?(i.p(o,r),r&1&&R(i,1)):(i=Ve(o),i.c(),R(i,1),i.m(e,null)):i&&(ne(),E(i,1,1,()=>{i=null}),ie())},i(o){n||(R(i),n=!0)},o(o){E(i),n=!1},d(o){o&&T(e),i&&i.d()}}}function vn(t,e,n,i,o){return o&&n!==i?"Passwords do not match":""}function Tn(t,e,n){let i;Q(t,ue,s=>n(3,i=s)),pe(()=>{ht({apiKey:"AIzaSyClWb9snAaau0p3gWecoCVMywUwIKgP7Eo",authDomain:"hackatown-2022.firebaseapp.com",projectId:"hackatown-2022",storageBucket:"hackatown-2022.appspot.com",messagingSenderId:"410454368204",appId:"1:410454368204:web:16fa9750c1621761564769"}),oe().onAuthStateChanged(s=>{le(ue,i=!!s,i),n(0,o=!0)})});let o=!1,r=!1,l="";async function a(s){const{name:d,email:b,password:y,confirmPassword:w,signup:f}=s.detail,g=vn(d,b,y,w,f);if(g!=""){n(2,l=g);return}f?await se.signUp(d,b,y)?(n(2,l=""),le(ue,i=!0,i)):n(2,l="Signup failed"):await se.login(b,y)?(n(2,l=""),le(ue,i=!0,i)):n(2,l="Invalid email or password")}function c(s){r=s,n(1,r)}return[o,r,l,i,a,c]}class Sn extends Y{constructor(e){super();Z(this,e,Tn,kn,J,{})}}new Sn({target:document.body});
