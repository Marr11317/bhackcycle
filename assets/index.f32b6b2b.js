var Ke=Object.defineProperty,Ve=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var ve=(t,e,n)=>e in t?Ke(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,de=(t,e)=>{for(var n in e||(e={}))Re.call(e,n)&&ve(t,n,e[n]);if(se)for(var n of se(e))Ie.call(e,n)&&ve(t,n,e[n]);return t},pe=(t,e)=>Ve(t,Je(e));var me=(t,e)=>{var n={};for(var i in t)Re.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&se)for(var i of se(t))e.indexOf(i)<0&&Ie.call(t,i)&&(n[i]=t[i]);return n};import{S as B,i as G,s as K,e as d,t as F,a as T,b as u,c as W,d as v,f as _,n as C,l as H,g as R,h as Ye,r as we,j as Ze,k as ne,w as ue,m as Qe,o as _e,p as ke,N as ye,U as Xe,q as je,u as He,D as Oe,v as xe,x as V,y as et,z as A,A as Te,B as tt,G as nt,L as j,C as We,E as Se,F as fe,H as L,I as Y,J as Z,K as D,M as Q,O as x,P as ee,Q as it,R as ot,T as te,V as rt,W as lt,X as st,Y as at,Z as ie,_ as ct,$ as ut,a0 as ft}from"./vendor.e274b491.js";const dt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};dt();function Le(t){let e,n,i;return{c(){e=d("ion-item"),n=d("ion-label"),i=F(t[1])},m(o,r){T(o,e,r),u(e,n),u(n,i)},p(o,r){r&2&&W(i,o[1])},d(o){o&&v(e)}}}function $e(t){let e,n;return{c(){e=d("ion-item"),n=d("ion-input"),_(n,"placeholder","Full Name"),_(n,"type","text"),_(n,"required","")},m(i,o){T(i,e,o),u(e,n),t[8](n)},p:C,d(i){i&&v(e),t[8](null)}}}function Ce(t){let e,n,i,o;return{c(){e=d("ion-item"),n=d("ion-input"),_(n,"placeholder","confirm password"),_(n,"type","password"),_(n,"required","")},m(r,l){T(r,e,l),u(e,n),t[11](n),i||(o=H(n,"keypress",t[7]),i=!0)},p:C,d(r){r&&v(e),t[11](null),i=!1,o()}}}function pt(t){let e,n,i,o=t[0]?"Sign up":"Login",r,l,s,c,a,f,m,k,g,p,I,y,w,b=t[0]?"Sign up":"Login",U,h,$,N=t[0]?"Login instead":"Sign up instead",J,X,P,S=t[1]!==""&&Le(t),M=t[0]&&$e(t),E=t[0]&&Ce(t);return{c(){e=d("ion-header"),n=d("ion-toolbar"),i=d("ion-title"),r=F(o),l=R(),s=d("ion-list"),S&&S.c(),c=R(),M&&M.c(),a=R(),f=d("ion-item"),m=d("ion-input"),k=R(),g=d("ion-item"),p=d("ion-input"),I=R(),E&&E.c(),y=R(),w=d("ion-button"),U=F(b),h=R(),$=d("ion-button"),J=F(N),_(e,"translucent",""),_(m,"placeholder","email"),_(m,"type","text"),_(m,"required",""),_(m,"autofocus",""),_(p,"placeholder","password"),_(p,"type","password"),_(p,"required",""),_(w,"expand","block"),_(s,"lines","full")},m(z,O){T(z,e,O),u(e,n),u(n,i),u(i,r),T(z,l,O),T(z,s,O),S&&S.m(s,null),u(s,c),M&&M.m(s,null),u(s,a),u(s,f),u(f,m),t[9](m),u(s,k),u(s,g),u(g,p),t[10](p),u(s,I),E&&E.m(s,null),u(s,y),u(s,w),u(w,U),T(z,h,O),T(z,$,O),u($,J),m.focus(),X||(P=[H(p,"keypress",function(){Ye(t[0]?void 0:t[7])&&(t[0]?void 0:t[7]).apply(this,arguments)}),H(w,"click",t[6]),H($,"click",t[12])],X=!0)},p(z,[O]){t=z,O&1&&o!==(o=t[0]?"Sign up":"Login")&&W(r,o),t[1]!==""?S?S.p(t,O):(S=Le(t),S.c(),S.m(s,c)):S&&(S.d(1),S=null),t[0]?M?M.p(t,O):(M=$e(t),M.c(),M.m(s,a)):M&&(M.d(1),M=null),t[0]?E?E.p(t,O):(E=Ce(t),E.c(),E.m(s,y)):E&&(E.d(1),E=null),O&1&&b!==(b=t[0]?"Sign up":"Login")&&W(U,b),O&1&&N!==(N=t[0]?"Login instead":"Sign up instead")&&W(J,N)},i:C,o:C,d(z){z&&v(e),z&&v(l),z&&v(s),S&&S.d(),M&&M.d(),t[9](null),t[10](null),E&&E.d(),z&&v(h),z&&v($),X=!1,we(P)}}}function mt(t,e,n){const i=Ze();function o(){!c||!a||r&&!f||i("submit",{name:s?s.value:void 0,email:c.value,password:a.value,confirmPassword:f?f.value:void 0,signup:r})}let{signup:r=!1}=e,{errorNote:l=""}=e,s,c,a,f;function m(w){w.key==="Enter"&&o()}function k(w){ne[w?"unshift":"push"](()=>{s=w,n(2,s)})}function g(w){ne[w?"unshift":"push"](()=>{c=w,n(3,c)})}function p(w){ne[w?"unshift":"push"](()=>{a=w,n(4,a)})}function I(w){ne[w?"unshift":"push"](()=>{f=w,n(5,f)})}const y=()=>n(0,r=!r);return t.$$set=w=>{"signup"in w&&n(0,r=w.signup),"errorNote"in w&&n(1,l=w.errorNote)},[r,l,s,c,a,f,o,m,k,g,p,I,y]}class _t extends B{constructor(e){super();G(this,e,mt,pt,K,{signup:0,errorNote:1})}}const bt=(t,e)=>{const n=localStorage.getItem(t),i=ue(n?JSON.parse(n):e);return i.subscribe(o=>localStorage.setItem(t,o?JSON.stringify(o):"")),i},ae=ue(!1),q=ue(null),be=ue(null),ce=bt("currentTrip",null),gt=t=>{ce.update(e=>e?(e.geopoints=[...e.geopoints,{timestamp:new Date().toISOString(),location:t}],e):null)},ge=t=>{if(!t.length)return 0;let e=0;for(let n=1;n<t.length-1;++n)e+=Qe(t[n-1].location,t[n].location);return e},ht={toFirestore:t=>({name:t.name,email:t.email,credits:t.credits,redeemedRewards:t.redeemedRewards}),fromFirestore:(t,e)=>{const n=t.data(e);return{name:n.name,email:n.email,credits:n.credits,redeemedRewards:n.redeemedRewards}}},qe={toFirestore:t=>({id:t.id,userEmail:t.userEmail,startTime:_e.fromDate(t.startTime),endTime:t.endTime?_e.fromDate(t.endTime):null,transportType:t.transportType,distance:t.distance,geopoints:t.geopoints}),fromFirestore:(t,e)=>{const n=t.data(e);return{id:n.id,userEmail:n.userEmail,startTime:n.startTime.toDate(),endTime:n.endTime?n.endTime.toDate():null,transportType:n.transportType,distance:n.distance,geopoints:n.geopoints}}},Ae={toFirestore:t=>({id:t.id,name:t.name,description:t.description,price:t.price,provider:t.provider,expiration:_e.fromDate(t.expiration),remainingUnits:t.remainingUnits}),fromFirestore:(t,e)=>{const n=t.data(e);return{id:n.id,name:n.name,description:n.description,price:n.price,provider:n.provider,expiration:n.expiration.toDate(),remainingUnits:n.remainingUnits}}},le=()=>Xe(),Be=t=>ye(le(),"users",t).withConverter(ht),wt=t=>ye(le(),"trips",t.id).withConverter(qe),kt=t=>ye(le(),"rewards",t.id).withConverter(Ae),yt=async t=>{const o=t,{redeemedRewards:e}=o,n=me(o,["redeemedRewards"]),i=pe(de({},n),{redeemedRewards:e.map(r=>r.id)});await ke(Be(t.email),i)},Tt=async t=>{await ke(wt(t),t)},vt=async t=>{await ke(kt(t),t)},Rt=async t=>{const e=await je(Be(t));if(!e.exists())return null;const n=e.data(),s=n,{redeemedRewards:i}=s,o=me(s,["redeemedRewards"]),r=await It(n.email),l=(await Ge()).filter(c=>(i||[]).includes(c.id));return pe(de({},o),{trips:r,redeemedRewards:l})},It=async t=>{const e=[];return(await He(Oe(le(),"trips").withConverter(qe))).forEach(i=>i.exists()&&e.push(i.data())),e.filter(i=>i.userEmail===t)},Ge=async()=>{const t=[];return(await He(Oe(le(),"rewards").withConverter(Ae))).forEach(n=>n.exists()&&t.push(n.data())),t};var oe={fetchUser:Rt,fetchAllRewards:Ge,updateUser:yt,updateTrip:Tt,updateReward:vt};function he(t){switch(t){case"bicycle":return"bicycle";case"walk":return"walk";case"publicTransport":return"bus";default:return"walk"}}const{window:St}=tt;function Ue(t,e,n){const i=t.slice();return i[15]=e[n],i}function Lt(t){let e,n,i,o,r=t[5],l=[];for(let s=0;s<r.length;s+=1)l[s]=De(Ue(t,r,s));return{c(){e=d("ion-fab"),n=d("ion-fab-button"),n.innerHTML='<ion-icon name="add"></ion-icon>',i=R(),o=d("ion-fab-list");for(let s=0;s<l.length;s+=1)l[s].c();_(o,"side","top"),_(e,"horizontal","center"),_(e,"vertical","bottom"),_(e,"slot","fixed")},m(s,c){T(s,e,c),u(e,n),u(e,i),u(e,o);for(let a=0;a<l.length;a+=1)l[a].m(o,null)},p(s,c){if(c&48){r=s[5];let a;for(a=0;a<r.length;a+=1){const f=Ue(s,r,a);l[a]?l[a].p(f,c):(l[a]=De(f),l[a].c(),l[a].m(o,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=r.length}},d(s){s&&v(e),We(l,s)}}}function $t(t){let e,n,i;return{c(){e=d("ion-fab"),e.innerHTML='<ion-fab-button><ion-icon name="close"></ion-icon></ion-fab-button>',_(e,"horizontal","center"),_(e,"vertical","bottom"),_(e,"slot","fixed")},m(o,r){T(o,e,r),n||(i=H(e,"click",t[3]),n=!0)},p:C,d(o){o&&v(e),n=!1,i()}}}function De(t){let e,n,i,o,r,l;function s(){return t[6](t[15])}return{c(){e=d("ion-fab-button"),n=d("ion-icon"),o=R(),_(n,"name",i=he(t[15]))},m(c,a){T(c,e,a),u(e,n),u(e,o),r||(l=H(e,"click",s),r=!0)},p(c,a){t=c},d(c){c&&v(e),r=!1,l()}}}function Ct(t){let e,n,i,o,r;function l(a,f){return a[0]?$t:Lt}let s=l(t),c=s(t);return{c(){e=d("ion-content"),c.c(),n=R(),i=d("div"),xe(i,"class","map svelte-vsoji2"),V(i,"height","100%"),V(i,"width","100%")},m(a,f){T(a,e,f),c.m(e,null),u(e,n),u(e,i),o||(r=[H(St,"resize",t[2]),et(t[1].call(null,i))],o=!0)},p(a,[f]){s===(s=l(a))&&c?c.p(a,f):(c.d(1),c=s(a),c&&(c.c(),c.m(e,n)))},i:C,o:C,d(a){a&&v(e),c.d(),o=!1,we(r)}}}function Ut(t,e,n){let i,o;A(t,ce,b=>n(0,i=b)),A(t,q,b=>n(11,o=b));let r=null,l=null,s=null;const c=async()=>{const b=await nt.getCurrentPosition();return{lat:b.coords.latitude,lng:b.coords.longitude}},a=b=>(r=j.map(b,{preferCanvas:!0}),j.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(r),r.setView([45.504755,-73.612572],14),{destroy:()=>{r==null||r.remove(),r=null}}),f=()=>r==null?void 0:r.invalidateSize(),m=async b=>{!r||(s==null||s.removeFrom(r),l==null||l.removeFrom(r),s=j.circleMarker(b,{color:"red",weight:2,opacity:.7}),l=j.polyline([b],{color:"red",weight:3,opacity:.5,smoothFactor:1}),s.addTo(r),l.addTo(r))},k=()=>{if(!r||!(i==null?void 0:i.geopoints.length))return;const b=i.geopoints.sort((U,h)=>U.timestamp<h.timestamp?-1:1).map(U=>[U.location.latitude,U.location.longitude]);s=j.circleMarker(b[b.length-1],{color:"red",weight:2,opacity:.7}),l=j.polyline(b,{color:"red",weight:3,opacity:.5,smoothFactor:1}),s.addTo(r),l.addTo(r)};let g=null;const p=()=>{if(g&&(clearInterval(g),g=null),!i)return;const b=ge(i.geopoints),U={id:i.id,userEmail:i.userEmail,transportType:i.transportType,startTime:new Date(i.startTime),endTime:new Date,distance:b,geopoints:i.geopoints.map(({location:h,timestamp:$})=>({location:h,timestamp:$}))};oe.updateTrip(U),ce.set(null),r&&(l==null||l.removeFrom(r),s==null||s.removeFrom(r)),q.update(h=>h?(h.credits+=Math.floor(5*b/1e3),h):null)},I=async b=>{ce.set({id:Date.now().toString(),userEmail:o.email,startTime:new Date().toISOString(),transportType:b,geopoints:[]});const U=await c();m(U),g=window.setInterval(async()=>{if(!i)return;const h=await c();gt({latitude:h.lat,longitude:h.lng}),i.geopoints.length==0?m(h):l==null||l.addLatLng(h)},3e3)};return Te(()=>{setTimeout(async()=>{const b=await c();r==null||r.setView(b),(i==null?void 0:i.geopoints.length)&&k(),f()},300)}),[i,a,f,p,I,["publicTransport","walk","bicycle"],b=>I(b)]}class Dt extends B{constructor(e){super();G(this,e,Ut,Ct,K,{})}}function Mt(t){let e,n,i,o=t[0].name+"",r,l,s,c=t[0].description+"",a,f,m,k,g=t[0].price+"",p,I,y,w,b,U,h=t[0].expiration?`Expires on ${t[0].expiration.toDateString()}`:"",$,N,J,X;return{c(){e=d("ion-card"),n=d("ion-card-header"),i=d("ion-card-title"),r=F(o),l=R(),s=d("ion-card-subtitle"),a=F(c),f=R(),m=d("ion-card-content"),k=F("Cost: "),p=F(g),I=R(),y=d("ion-icon"),w=R(),b=d("br"),U=R(),$=F(h),_(s,"class","sub svelte-aab9bb"),V(y,"color","green"),V(y,"font-size","16px"),V(y,"padding-left","3px"),_(y,"name","leaf-outline"),_(m,"class","content svelte-aab9bb"),_(e,"class",N=Se(t[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")},m(P,S){T(P,e,S),u(e,n),u(n,i),u(i,r),u(n,l),u(n,s),u(s,a),u(e,f),u(e,m),u(m,k),u(m,p),u(m,I),u(m,y),u(m,w),u(m,b),u(m,U),u(m,$),J||(X=H(e,"click",t[3]),J=!0)},p(P,[S]){S&1&&o!==(o=P[0].name+"")&&W(r,o),S&1&&c!==(c=P[0].description+"")&&W(a,c),S&1&&g!==(g=P[0].price+"")&&W(p,g),S&1&&h!==(h=P[0].expiration?`Expires on ${P[0].expiration.toDateString()}`:"")&&W($,h),S&2&&N!==(N=Se(P[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")&&_(e,"class",N)},i:C,o:C,d(P){P&&v(e),J=!1,X()}}}function Et(t,e,n){let i;A(t,q,a=>n(4,i=a));let{reward:o}=e,r=(i==null?void 0:i.redeemedRewards.findIndex(a=>a.id===o.id))!==-1;function l(){!i||s()||!o.remainingUnits||i.credits<o.price||(q.update(a=>a&&(n(1,r=!0),a.credits-=o.price,a.redeemedRewards=[...a.redeemedRewards,o],a)),n(0,o.remainingUnits--,o))}function s(){return(i==null?void 0:i.redeemedRewards.findIndex(a=>a.id===o.id))!==-1}const c=()=>l();return t.$$set=a=>{"reward"in a&&n(0,o=a.reward)},[o,r,l,c]}class Nt extends B{constructor(e){super();G(this,e,Et,Mt,K,{reward:0})}}function Me(t,e,n){const i=t.slice();return i[2]=e[n],i}function Ee(t){let e,n,i=t[1],o=[];for(let l=0;l<i.length;l+=1)o[l]=Ne(Me(t,i,l));const r=l=>D(o[l],1,1,()=>{o[l]=null});return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=fe()},m(l,s){for(let c=0;c<o.length;c+=1)o[c].m(l,s);T(l,e,s),n=!0},p(l,s){if(s&2){i=l[1];let c;for(c=0;c<i.length;c+=1){const a=Me(l,i,c);o[c]?(o[c].p(a,s),L(o[c],1)):(o[c]=Ne(a),o[c].c(),L(o[c],1),o[c].m(e.parentNode,e))}for(x(),c=i.length;c<o.length;c+=1)r(c);ee()}},i(l){if(!n){for(let s=0;s<i.length;s+=1)L(o[s]);n=!0}},o(l){o=o.filter(Boolean);for(let s=0;s<o.length;s+=1)D(o[s]);n=!1},d(l){We(o,l),l&&v(e)}}}function Ne(t){let e,n;return e=new Nt({props:{reward:t[2]}}),{c(){Y(e.$$.fragment)},m(i,o){Z(e,i,o),n=!0},p(i,o){const r={};o&2&&(r.reward=i[2]),e.$set(r)},i(i){n||(L(e.$$.fragment,i),n=!0)},o(i){D(e.$$.fragment,i),n=!1},d(i){Q(e,i)}}}function Pt(t){var I;let e,n,i,o,r,l,s,c=((I=t[0])==null?void 0:I.credits)+"",a,f,m,k,g,p=t[1]&&Ee(t);return{c(){e=d("ion-header"),e.innerHTML="<ion-toolbar><ion-title>Rewards</ion-title></ion-toolbar>",n=R(),i=d("ion-content"),o=d("ion-list"),r=d("ion-list-header"),l=d("h2"),s=F("You have "),a=F(c),f=R(),m=d("ion-icon"),k=R(),p&&p.c(),_(e,"translucent",""),V(m,"color","green"),V(m,"font-size","32px"),V(m,"padding-left","3px"),_(m,"name","leaf-outline")},m(y,w){T(y,e,w),T(y,n,w),T(y,i,w),u(i,o),u(o,r),u(r,l),u(l,s),u(l,a),u(r,f),u(r,m),u(o,k),p&&p.m(o,null),g=!0},p(y,[w]){var b;(!g||w&1)&&c!==(c=((b=y[0])==null?void 0:b.credits)+"")&&W(a,c),y[1]?p?(p.p(y,w),w&2&&L(p,1)):(p=Ee(y),p.c(),L(p,1),p.m(o,null)):p&&(x(),D(p,1,1,()=>{p=null}),ee())},i(y){g||(L(p),g=!0)},o(y){D(p),g=!1},d(y){y&&v(e),y&&v(n),y&&v(i),p&&p.d()}}}function zt(t,e,n){let i,o;return A(t,q,r=>n(0,i=r)),A(t,be,r=>n(1,o=r)),[i,o]}class Ft extends B{constructor(e){super();G(this,e,zt,Pt,K,{})}}function Ht(t){let e,n,i,o,r,l,s,c;return{c(){e=d("ion-list"),n=d("ion-item"),n.innerHTML=`Logout
        <ion-icon name="log-out-outline" slot="end"></ion-icon>`,i=R(),o=d("ion-item"),o.innerHTML=`about
        <ion-icon name="information-circle-outline" slot="end"></ion-icon>`,r=R(),l=d("ion-item"),l.innerHTML=`GitHub Repo
        <ion-icon name="logo-github" slot="end"></ion-icon>`,_(n,"button",""),_(o,"button",""),_(l,"lines","none"),_(l,"button",""),_(e,"lines","n")},m(a,f){T(a,e,f),u(e,n),u(e,i),u(e,o),u(e,r),u(e,l),s||(c=[H(n,"click",t[1]),H(o,"click",t[2]),H(l,"click",t[3])],s=!0)},p:C,i:C,o:C,d(a){a&&v(e),s=!1,we(c)}}}function Ot(t){let e=document.querySelector("ion-popover");const n=l=>{e==null||e.dismiss(l)};return[n,()=>{n("logout")},()=>{n("about")},()=>{n("github")}]}class Wt extends B{constructor(e){super();G(this,e,Ot,Ht,K,{})}}const qt=function(t){return document.createElement(t).constructor!==HTMLElement},At=(t,e)=>{qt(t)||ot(t,e,[])},Bt=(t,e,n,i)=>(At(e,n),it.create({component:e,event:t,componentProps:i}).then(o=>(o.present(),o.onWillDismiss()))),Gt=()=>!!te().currentUser,Kt=()=>{var t;return((t=te().currentUser)==null?void 0:t.email)||null},Vt=async(t,e)=>{try{return await rt(te(),t,e),!0}catch(n){return console.log("Failed to login"),console.log(n),!1}},Jt=()=>te().signOut(),Yt=async(t,e,n)=>{try{return await lt(te(),e,n),await oe.updateUser({email:e,name:t,credits:100,redeemedRewards:[],trips:[]}),!0}catch(i){return console.log("Failed to sign up"),console.log(i),!1}};var re={logout:Jt,login:Vt,getCurrentUser:Kt,isLoggedIn:Gt,signUp:Yt};function Zt(t){let e,n,i,o,r,l=ge(t[0].geopoints)+"",s;return{c(){e=d("ion-item"),n=d("ion-icon"),o=R(),r=d("ion-label"),s=F(l),_(n,"name",i=he(t[0].transportType)),_(n,"slot","start")},m(c,a){T(c,e,a),u(e,n),u(e,o),u(e,r),u(r,s)},p(c,[a]){a&1&&i!==(i=he(c[0].transportType))&&_(n,"name",i),a&1&&l!==(l=ge(c[0].geopoints)+"")&&W(s,l)},i:C,o:C,d(c){c&&v(e)}}}function Qt(t,e,n){let{trip:i}=e;return t.$$set=o=>{"trip"in o&&n(0,i=o.trip)},[i]}class Xt extends B{constructor(e){super();G(this,e,Qt,Zt,K,{trip:0})}}function Pe(t,e,n){const i=t.slice();return i[3]=e[n],i}function jt(t){let e,n,i,o,r,l;return{c(){e=d("ion-item"),n=d("ion-label"),n.textContent="Failed to load user",i=R(),o=d("ion-button"),o.textContent="Go back to login page",_(o,"slot","end"),_(o,"fill","outline")},m(s,c){T(s,e,c),u(e,n),u(e,i),u(e,o),r||(l=H(o,"click",t[2]),r=!0)},p:C,i:C,o:C,d(s){s&&v(e),r=!1,l()}}}function xt(t){let e,n,i=[],o=new Map,r,l,s=t[0].trips;const c=a=>a[3].id;for(let a=0;a<s.length;a+=1){let f=Pe(t,s,a),m=c(f);o.set(m,i[a]=ze(m,f))}return{c(){e=d("ion-list-header"),e.innerHTML="<ion-label>Trips</ion-label>",n=R();for(let a=0;a<i.length;a+=1)i[a].c();r=fe()},m(a,f){T(a,e,f),T(a,n,f);for(let m=0;m<i.length;m+=1)i[m].m(a,f);T(a,r,f),l=!0},p(a,f){f&1&&(s=a[0].trips,x(),i=st(i,f,c,1,a,s,o,r.parentNode,at,ze,r,Pe),ee())},i(a){if(!l){for(let f=0;f<s.length;f+=1)L(i[f]);l=!0}},o(a){for(let f=0;f<i.length;f+=1)D(i[f]);l=!1},d(a){a&&v(e),a&&v(n);for(let f=0;f<i.length;f+=1)i[f].d(a);a&&v(r)}}}function ze(t,e){let n,i,o;return i=new Xt({props:{trip:e[3]}}),{key:t,first:null,c(){n=fe(),Y(i.$$.fragment),this.first=n},m(r,l){T(r,n,l),Z(i,r,l),o=!0},p(r,l){e=r;const s={};l&1&&(s.trip=e[3]),i.$set(s)},i(r){o||(L(i.$$.fragment,r),o=!0)},o(r){D(i.$$.fragment,r),o=!1},d(r){r&&v(n),Q(i,r)}}}function en(t){let e,n,i,o,r,l,s=(t[0]?t[0].name:"Profile")+"",c,a,f,m,k,g,p,I,y;const w=[xt,jt],b=[];function U(h,$){return h[0]?0:1}return k=U(t),g=b[k]=w[k](t),{c(){e=d("ion-header"),n=d("ion-toolbar"),i=d("ion-buttons"),o=d("ion-button"),o.innerHTML='<ion-icon slot="icon-only" ios="ellipsis-horizontal" md="ellipsis-vertical"></ion-icon>',r=R(),l=d("ion-title"),c=F(s),a=R(),f=d("ion-content"),m=d("ion-list"),g.c(),_(i,"slot","primary"),_(e,"translucent","")},m(h,$){T(h,e,$),u(e,n),u(n,i),u(i,o),u(n,r),u(n,l),u(l,c),T(h,a,$),T(h,f,$),u(f,m),b[k].m(m,null),p=!0,I||(y=H(o,"click",t[1]),I=!0)},p(h,[$]){(!p||$&1)&&s!==(s=(h[0]?h[0].name:"Profile")+"")&&W(c,s);let N=k;k=U(h),k===N?b[k].p(h,$):(x(),D(b[N],1,1,()=>{b[N]=null}),ee(),g=b[k],g?g.p(h,$):(g=b[k]=w[k](h),g.c()),L(g,1),g.m(m,null))},i(h){p||(L(g),p=!0)},o(h){D(g),p=!1},d(h){h&&v(e),h&&v(a),h&&v(f),b[k].d(),I=!1,y()}}}function tn(t,e,n){let i;A(t,q,l=>n(0,i=l));function o(l){Bt(l,"popover-extra",Wt,{}).then(async s=>{s.data=="logout"&&await re.logout()})}return[i,o,()=>re.logout()]}class nn extends B{constructor(e){super();G(this,e,tn,en,K,{})}}function on(t){let e,n,i,o,r,l,s,c,a,f,m,k,g;return o=new Dt({}),s=new Ft({}),f=new nn({}),{c(){e=d("ion-app"),n=d("ion-tabs"),i=d("ion-tab"),Y(o.$$.fragment),r=R(),l=d("ion-tab"),Y(s.$$.fragment),c=R(),a=d("ion-tab"),Y(f.$$.fragment),m=R(),k=d("ion-tab-bar"),k.innerHTML=`<ion-tab-button tab="map"><ion-label>Map</ion-label> 
        <ion-icon name="bicycle-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="rewards"><ion-label>Rewards</ion-label> 
        <ion-icon name="trophy-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="profile"><ion-label>profile</ion-label> 
        <ion-icon name="analytics-outline"></ion-icon></ion-tab-button>`,_(i,"tab","map"),_(l,"tab","rewards"),_(a,"tab","profile"),_(k,"slot","bottom")},m(p,I){T(p,e,I),u(e,n),u(n,i),Z(o,i,null),u(n,r),u(n,l),Z(s,l,null),u(n,c),u(n,a),Z(f,a,null),u(n,m),u(n,k),g=!0},p:C,i(p){g||(L(o.$$.fragment,p),L(s.$$.fragment,p),L(f.$$.fragment,p),g=!0)},o(p){D(o.$$.fragment,p),D(s.$$.fragment,p),D(f.$$.fragment,p),g=!1},d(p){p&&v(e),Q(o),Q(s),Q(f)}}}function rn(t,e,n){let i,o;return A(t,be,r=>n(0,i=r)),A(t,q,r=>n(1,o=r)),Te(async()=>{const r=await oe.fetchUser(re.getCurrentUser());ie(q,o=r,o);const l=await oe.fetchAllRewards();ie(be,i=l,i)}),q.subscribe(async r=>{r&&await oe.updateUser(r)}),[]}class ln extends B{constructor(e){super();G(this,e,rn,on,K,{})}}function Fe(t){let e,n,i,o;const r=[an,sn],l=[];function s(c,a){return c[3]?1:0}return e=s(t),n=l[e]=r[e](t),{c(){n.c(),i=fe()},m(c,a){l[e].m(c,a),T(c,i,a),o=!0},p(c,a){let f=e;e=s(c),e===f?l[e].p(c,a):(x(),D(l[f],1,1,()=>{l[f]=null}),ee(),n=l[e],n?n.p(c,a):(n=l[e]=r[e](c),n.c()),L(n,1),n.m(i.parentNode,i))},i(c){o||(L(n),o=!0)},o(c){D(n),o=!1},d(c){l[e].d(c),c&&v(i)}}}function sn(t){let e,n;return e=new ln({}),{c(){Y(e.$$.fragment)},m(i,o){Z(e,i,o),n=!0},p:C,i(i){n||(L(e.$$.fragment,i),n=!0)},o(i){D(e.$$.fragment,i),n=!1},d(i){Q(e,i)}}}function an(t){let e,n,i;function o(l){t[5](l)}let r={errorNote:t[2]};return t[1]!==void 0&&(r.signup=t[1]),e=new _t({props:r}),ne.push(()=>ct(e,"signup",o)),e.$on("submit",t[4]),{c(){Y(e.$$.fragment)},m(l,s){Z(e,l,s),i=!0},p(l,s){const c={};s&4&&(c.errorNote=l[2]),!n&&s&2&&(n=!0,c.signup=l[1],ut(()=>n=!1)),e.$set(c)},i(l){i||(L(e.$$.fragment,l),i=!0)},o(l){D(e.$$.fragment,l),i=!1},d(l){Q(e,l)}}}function cn(t){let e,n,i=t[0]&&Fe(t);return{c(){e=d("ion-app"),i&&i.c()},m(o,r){T(o,e,r),i&&i.m(e,null),n=!0},p(o,[r]){o[0]?i?(i.p(o,r),r&1&&L(i,1)):(i=Fe(o),i.c(),L(i,1),i.m(e,null)):i&&(x(),D(i,1,1,()=>{i=null}),ee())},i(o){n||(L(i),n=!0)},o(o){D(i),n=!1},d(o){o&&v(e),i&&i.d()}}}function un(t,e,n,i,o){return o&&n!==i?"Passwords do not match":""}function fn(t,e,n){let i;A(t,ae,a=>n(3,i=a)),Te(()=>{ft({apiKey:"AIzaSyClWb9snAaau0p3gWecoCVMywUwIKgP7Eo",authDomain:"hackatown-2022.firebaseapp.com",projectId:"hackatown-2022",storageBucket:"hackatown-2022.appspot.com",messagingSenderId:"410454368204",appId:"1:410454368204:web:16fa9750c1621761564769"}),te().onAuthStateChanged(a=>{ie(ae,i=!!a,i),n(0,o=!0)})});let o=!1,r=!1,l="";async function s(a){const{name:f,email:m,password:k,confirmPassword:g,signup:p}=a.detail,I=un(f,m,k,g,p);if(I!=""){n(2,l=I);return}p?await re.signUp(f,m,k)?(n(2,l=""),ie(ae,i=!0,i)):n(2,l="Signup failed"):await re.login(m,k)?(n(2,l=""),ie(ae,i=!0,i)):n(2,l="Invalid email or password")}function c(a){r=a,n(1,r)}return[o,r,l,i,s,c]}class dn extends B{constructor(e){super();G(this,e,fn,cn,K,{})}}new dn({target:document.body});
