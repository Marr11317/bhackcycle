var je=Object.defineProperty,Xe=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var Re=(n,e,t)=>e in n?je(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_e=(n,e)=>{for(var t in e||(e={}))ze.call(e,t)&&Re(n,t,e[t]);if(ue)for(var t of ue(e))Ee.call(e,t)&&Re(n,t,e[t]);return n},be=(n,e)=>Xe(n,xe(e));var ge=(n,e)=>{var t={};for(var i in n)ze.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&ue)for(var i of ue(n))e.indexOf(i)<0&&Ee.call(n,i)&&(t[i]=n[i]);return t};import{S as Y,i as Z,s as J,e as _,t as W,a as $,b as S,c as u,d as G,f as I,g,n as D,l as N,h as M,j as et,r as ae,k as tt,m as ne,w as pe,o as nt,p as he,q as ve,N as Te,U as it,u as ot,v as Se,D as Ie,E as rt,x as Me,y as Ye,z as Q,A as me,B as lt,G as st,L as q,C as Ze,F as De,H as ce,I as L,J as j,K as X,M as R,O as x,P as ee,Q as te,R as at,T as ct,V as oe,W as ut,X as ft,Y as dt,Z as pt,_ as mt,$ as le,a0 as _t,a1 as bt,a2 as gt}from"./vendor.2488a5cb.js";const ht=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}};ht();function Ne(n){let e,t,i;return{c(){e=_("ion-item"),t=_("ion-label"),i=W(n[1]),$(t,"color","red")},m(o,r){S(o,e,r),u(e,t),u(t,i)},p(o,r){r&2&&G(i,o[1])},d(o){o&&I(e)}}}function Ue(n){let e,t;return{c(){e=_("ion-item"),t=_("ion-input"),g(t,"placeholder","Full Name"),g(t,"type","text"),g(t,"required","")},m(i,o){S(i,e,o),u(e,t),n[8](t)},p:D,d(i){i&&I(e),n[8](null)}}}function $e(n){let e,t,i,o;return{c(){e=_("ion-item"),t=_("ion-input"),g(t,"placeholder","confirm password"),g(t,"type","password"),g(t,"required","")},m(r,l){S(r,e,l),u(e,t),n[11](t),i||(o=N(t,"keypress",n[7]),i=!0)},p:D,d(r){r&&I(e),n[11](null),i=!1,o()}}}function wt(n){let e,t,i,o=n[0]?"Sign up":"Login",r,l,a,c,s,b,f,k,h,m,w,p,d,T,C,y=n[0]?"Sign up":"Login",z,v,E,B=n[0]?"Login instead":"Sign up instead",F,V,Ce,P=n[1]!==""&&Ne(n),H=n[0]&&Ue(n),O=n[0]&&$e(n);return{c(){e=_("ion-header"),t=_("ion-toolbar"),i=_("ion-title"),r=W(o),l=M(),a=_("ion-icon"),c=M(),s=_("ion-list"),P&&P.c(),b=M(),H&&H.c(),f=M(),k=_("ion-item"),h=_("ion-input"),m=M(),w=_("ion-item"),p=_("ion-input"),d=M(),O&&O.c(),T=M(),C=_("ion-button"),z=W(y),v=M(),E=_("ion-button"),F=W(B),g(e,"translucent",""),$(a,"position","fixed"),$(a,"left","calc(50% - 64px)"),$(a,"margin-right","auto"),$(a,"top","15%"),$(a,"font-size","128px"),$(a,"color","lightgray"),g(a,"name","bicycle"),g(h,"placeholder","email"),g(h,"type","text"),g(h,"required",""),g(h,"autofocus",""),g(p,"placeholder","password"),g(p,"type","password"),g(p,"required",""),g(C,"expand","block"),g(s,"lines","full")},m(U,A){S(U,e,A),u(e,t),u(t,i),u(i,r),S(U,l,A),S(U,a,A),S(U,c,A),S(U,s,A),P&&P.m(s,null),u(s,b),H&&H.m(s,null),u(s,f),u(s,k),u(k,h),n[9](h),u(s,m),u(s,w),u(w,p),n[10](p),u(s,d),O&&O.m(s,null),u(s,T),u(s,C),u(C,z),S(U,v,A),S(U,E,A),u(E,F),h.focus(),V||(Ce=[N(p,"keypress",function(){et(n[0]?void 0:n[7])&&(n[0]?void 0:n[7]).apply(this,arguments)}),N(C,"click",n[6]),N(E,"click",n[12])],V=!0)},p(U,[A]){n=U,A&1&&o!==(o=n[0]?"Sign up":"Login")&&G(r,o),n[1]!==""?P?P.p(n,A):(P=Ne(n),P.c(),P.m(s,b)):P&&(P.d(1),P=null),n[0]?H?H.p(n,A):(H=Ue(n),H.c(),H.m(s,f)):H&&(H.d(1),H=null),n[0]?O?O.p(n,A):(O=$e(n),O.c(),O.m(s,T)):O&&(O.d(1),O=null),A&1&&y!==(y=n[0]?"Sign up":"Login")&&G(z,y),A&1&&B!==(B=n[0]?"Login instead":"Sign up instead")&&G(F,B)},i:D,o:D,d(U){U&&I(e),U&&I(l),U&&I(a),U&&I(c),U&&I(s),P&&P.d(),H&&H.d(),n[9](null),n[10](null),O&&O.d(),U&&I(v),U&&I(E),V=!1,ae(Ce)}}}function yt(n,e,t){const i=tt();function o(){!c||!s||r&&!b||i("submit",{name:a?a.value:void 0,email:c.value,password:s.value,confirmPassword:b?b.value:void 0,signup:r})}let{signup:r=!1}=e,{errorNote:l=""}=e,a,c,s,b;function f(d){d.key==="Enter"&&o()}function k(d){ne[d?"unshift":"push"](()=>{a=d,t(2,a)})}function h(d){ne[d?"unshift":"push"](()=>{c=d,t(3,c)})}function m(d){ne[d?"unshift":"push"](()=>{s=d,t(4,s)})}function w(d){ne[d?"unshift":"push"](()=>{b=d,t(5,b)})}const p=()=>t(0,r=!r);return n.$$set=d=>{"signup"in d&&t(0,r=d.signup),"errorNote"in d&&t(1,l=d.errorNote)},[r,l,a,c,s,b,o,f,k,h,m,w,p]}class kt extends Y{constructor(e){super();Z(this,e,yt,wt,J,{signup:0,errorNote:1})}}const vt=(n,e)=>{const t=localStorage.getItem(n),i=pe(t?JSON.parse(t):e);return i.subscribe(o=>localStorage.setItem(n,o?JSON.stringify(o):"")),i},fe=pe(!1),K=pe(null),we=pe(null),de=vt("currentTrip",null),Tt=n=>{de.update(e=>e?(e.geopoints=[...e.geopoints,{timestamp:new Date().toISOString(),location:n}],e):null)},ye=n=>{if(!n.length)return 0;let e=0;for(let t=1;t<n.length-1;++t)e+=nt(n[t-1].location,n[t].location);return e},St=n=>{let e=n.geopoints.map(t=>({latitude:t.location.latitude,longitude:t.location.longitude})).reduce((t,i)=>({latitude:t.latitude+i.latitude,longitude:i.longitude+t.longitude}));return e.latitude/=n.geopoints.length,e.longitude/=n.geopoints.length,e},It={toFirestore:n=>({name:n.name,email:n.email,credits:n.credits,redeemedRewards:n.redeemedRewards}),fromFirestore:(n,e)=>{const t=n.data(e);return{name:t.name,email:t.email,credits:t.credits,redeemedRewards:t.redeemedRewards}}},Le={toFirestore:n=>({id:n.id,userEmail:n.userEmail,startTime:he.fromDate(n.startTime),endTime:n.endTime?he.fromDate(n.endTime):null,transportType:n.transportType,distance:n.distance,geopoints:n.geopoints}),fromFirestore:(n,e)=>{const t=n.data(e);return{id:t.id,userEmail:t.userEmail,startTime:t.startTime.toDate(),endTime:t.endTime?t.endTime.toDate():null,transportType:t.transportType,distance:t.distance,geopoints:t.geopoints}}},Je={toFirestore:n=>({id:n.id,name:n.name,description:n.description,price:n.price,provider:n.provider,expiration:he.fromDate(n.expiration),remainingUnits:n.remainingUnits}),fromFirestore:(n,e)=>{const t=n.data(e);return{id:t.id,name:t.name,description:t.description,price:t.price,provider:t.provider,expiration:t.expiration.toDate(),remainingUnits:t.remainingUnits}}},re=()=>it(),Ke=n=>Te(re(),"users",n).withConverter(It),Mt=n=>Te(re(),"trips",n.id).withConverter(Le),Lt=n=>Te(re(),"rewards",n.id).withConverter(Je),Ct=async n=>{const o=n,{redeemedRewards:e}=o,t=ge(o,["redeemedRewards"]),i=be(_e({},t),{redeemedRewards:e.map(r=>r.id)});await ve(Ke(n.email),i)},Rt=async n=>{await ve(Mt(n),n)},zt=async n=>{await ve(Lt(n),n)},Et=async n=>{const e=await ot(Ke(n));if(!e.exists())return null;const t=e.data(),a=t,{redeemedRewards:i}=a,o=ge(a,["redeemedRewards"]),r=await Dt(t.email),l=(await Qe()).filter(c=>(i||[]).includes(c.id));return be(_e({},o),{trips:r,redeemedRewards:l})},Dt=async n=>{const e=[];return(await Se(Ie(re(),"trips").withConverter(Le))).forEach(i=>i.exists()&&e.push(i.data())),e.filter(i=>i.userEmail===n)},Nt=async n=>{(await Se(Ie(re(),"trips").withConverter(Le))).forEach(t=>{t.exists()&&t.data().id===n&&rt(t.ref)})},Qe=async()=>{const n=[];return(await Se(Ie(re(),"rewards").withConverter(Je))).forEach(t=>t.exists()&&n.push(t.data())),n};var ie={fetchUser:Et,fetchAllRewards:Qe,updateUser:Ct,updateTrip:Rt,updateReward:zt,deleteTrip:Nt};function ke(n){switch(n){case"bicycle":return"bicycle";case"walk":return"walk";case"publicTransport":return"bus";default:return"walk"}}const{window:Ut}=lt;function Fe(n,e,t){const i=n.slice();return i[17]=e[t],i}function $t(n){let e,t,i,o,r=n[6],l=[];for(let a=0;a<r.length;a+=1)l[a]=Pe(Fe(n,r,a));return{c(){e=_("ion-fab"),t=_("ion-fab-button"),t.innerHTML='<ion-icon name="add"></ion-icon>',i=M(),o=_("ion-fab-list");for(let a=0;a<l.length;a+=1)l[a].c();g(o,"side","top"),g(e,"horizontal","center"),g(e,"vertical","bottom"),g(e,"slot","fixed")},m(a,c){S(a,e,c),u(e,t),u(e,i),u(e,o);for(let s=0;s<l.length;s+=1)l[s].m(o,null)},p(a,c){if(c&80){r=a[6];let s;for(s=0;s<r.length;s+=1){const b=Fe(a,r,s);l[s]?l[s].p(b,c):(l[s]=Pe(b),l[s].c(),l[s].m(o,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=r.length}},d(a){a&&I(e),Ze(l,a)}}}function Ft(n){let e,t,i;return{c(){e=_("ion-fab"),e.innerHTML='<ion-fab-button><ion-icon name="close"></ion-icon></ion-fab-button>',g(e,"horizontal","center"),g(e,"vertical","bottom"),g(e,"slot","fixed")},m(o,r){S(o,e,r),t||(i=N(e,"click",n[3]),t=!0)},p:D,d(o){o&&I(e),t=!1,i()}}}function Pe(n){let e,t,i,o,r,l;function a(){return n[7](n[17])}return{c(){e=_("ion-fab-button"),t=_("ion-icon"),o=M(),g(t,"name",i=ke(n[17]))},m(c,s){S(c,e,s),u(e,t),u(e,o),r||(l=N(e,"click",a),r=!0)},p(c,s){n=c},d(c){c&&I(e),r=!1,l()}}}function Pt(n){let e,t,i,o,r,l,a;function c(f,k){return f[0]?Ft:$t}let s=c(n),b=s(n);return{c(){e=_("ion-content"),t=_("ion-fab"),t.innerHTML='<ion-fab-button><ion-icon name="pin"></ion-icon></ion-fab-button>',i=M(),b.c(),o=M(),r=_("div"),g(t,"horizontal","end"),g(t,"vertical","top"),g(t,"slot","fixed"),Me(r,"class","map svelte-vsoji2"),$(r,"height","100%"),$(r,"width","100%")},m(f,k){S(f,e,k),u(e,t),u(e,i),b.m(e,null),u(e,o),u(e,r),l||(a=[N(Ut,"resize",n[2]),N(t,"click",n[5]),Ye(n[1].call(null,r))],l=!0)},p(f,[k]){s===(s=c(f))&&b?b.p(f,k):(b.d(1),b=s(f),b&&(b.c(),b.m(e,o)))},i:D,o:D,d(f){f&&I(e),b.d(),l=!1,ae(a)}}}function Ht(n,e,t){let i,o;Q(n,de,y=>t(0,i=y)),Q(n,K,y=>t(13,o=y));let r=null,l=null,a=null,c=null;const s=async()=>{const y=await st.getCurrentPosition();return{lat:y.coords.latitude,lng:y.coords.longitude}},b=y=>(r=q.map(y,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(r),r.setView([45.504755,-73.612572],14),{destroy:()=>{r==null||r.remove(),r=null}}),f=()=>r==null?void 0:r.invalidateSize(),k=async y=>{!r||(a==null||a.removeFrom(r),l==null||l.removeFrom(r),c=q.circleMarker(y,{color:"red",weight:2,opacity:.7}),a=q.circleMarker(y,{color:"red",weight:2,opacity:.7}),l=q.polyline([y],{color:"red",weight:3,opacity:.5,smoothFactor:1}),c.addTo(r),a.addTo(r),l.addTo(r))},h=()=>{if(!r||!(i==null?void 0:i.geopoints.length))return;const y=i.geopoints.sort((z,v)=>z.timestamp<v.timestamp?-1:1).map(z=>[z.location.latitude,z.location.longitude]);a=q.circleMarker(y[0],{color:"red",weight:2,opacity:.7}),c=q.circleMarker(y[y.length-1],{color:"red",weight:2,opacity:.7}),l=q.polyline(y,{color:"red",weight:3,opacity:.5,smoothFactor:1}),a.addTo(r),c.addTo(r),l.addTo(r)};let m=null;const w=()=>{if(m&&(clearInterval(m),m=null),!i)return;const y=ye(i.geopoints),z={id:i.id,userEmail:i.userEmail,transportType:i.transportType,startTime:new Date(i.startTime),endTime:new Date,distance:y,geopoints:i.geopoints.map(({location:v,timestamp:E})=>({location:v,timestamp:E}))};ie.updateTrip(z),de.set(null),r&&(l==null||l.removeFrom(r),a==null||a.removeFrom(r),c==null||c.removeFrom(r)),K.update(v=>v?(v.credits+=Math.floor(.28*y/1e3),v.trips=[...v.trips,z],v):null)},p=async y=>{de.set({id:Date.now().toString(),userEmail:o.email,startTime:new Date().toISOString(),transportType:y,geopoints:[]});const z=await s();k(z),m=window.setInterval(async()=>{if(!i)return;const v=await s();Tt({latitude:v.lat,longitude:v.lng}),i.geopoints.length==0?k(v):l==null||l.addLatLng(v)},3e3)},d=async()=>{const y=await s();r==null||r.setView(y),f()};return me(()=>{setTimeout(async()=>{const y=await s();r==null||r.setView(y),(i==null?void 0:i.geopoints.length)&&h(),f()},300)}),[i,b,f,w,p,d,["publicTransport","walk","bicycle"],y=>p(y)]}class Ot extends Y{constructor(e){super();Z(this,e,Ht,Pt,J,{})}}function At(n){let e,t,i,o=n[0].name+"",r,l,a,c=n[0].description+"",s,b,f,k,h=n[0].price+"",m,w,p,d,T,C,y=n[0].expiration?`Expires on ${n[0].expiration.toDateString()}`:"",z,v,E,B;return{c(){e=_("ion-card"),t=_("ion-card-header"),i=_("ion-card-title"),r=W(o),l=M(),a=_("ion-card-subtitle"),s=W(c),b=M(),f=_("ion-card-content"),k=W("Cost: "),m=W(h),w=M(),p=_("ion-icon"),d=M(),T=_("br"),C=M(),z=W(y),g(a,"class","sub svelte-aab9bb"),$(p,"color","green"),$(p,"font-size","16px"),$(p,"padding-left","3px"),g(p,"name","leaf-outline"),g(f,"class","content svelte-aab9bb"),g(e,"class",v=De(n[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")},m(F,V){S(F,e,V),u(e,t),u(t,i),u(i,r),u(t,l),u(t,a),u(a,s),u(e,b),u(e,f),u(f,k),u(f,m),u(f,w),u(f,p),u(f,d),u(f,T),u(f,C),u(f,z),E||(B=N(e,"click",n[3]),E=!0)},p(F,[V]){V&1&&o!==(o=F[0].name+"")&&G(r,o),V&1&&c!==(c=F[0].description+"")&&G(s,c),V&1&&h!==(h=F[0].price+"")&&G(m,h),V&1&&y!==(y=F[0].expiration?`Expires on ${F[0].expiration.toDateString()}`:"")&&G(z,y),V&2&&v!==(v=De(F[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")&&g(e,"class",v)},i:D,o:D,d(F){F&&I(e),E=!1,B()}}}function Wt(n,e,t){let i;Q(n,K,s=>t(4,i=s));let{reward:o}=e,r=(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1;function l(){!i||a()||!o.remainingUnits||i.credits<o.price||(K.update(s=>s&&(t(1,r=!0),s.credits-=o.price,s.redeemedRewards=[...s.redeemedRewards,o],s)),t(0,o.remainingUnits--,o))}function a(){return(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1}const c=()=>l();return n.$$set=s=>{"reward"in s&&t(0,o=s.reward)},[o,r,l,c]}class qt extends Y{constructor(e){super();Z(this,e,Wt,At,J,{reward:0})}}function He(n,e,t){const i=n.slice();return i[2]=e[t],i}function Oe(n){let e,t,i=n[1],o=[];for(let l=0;l<i.length;l+=1)o[l]=Ae(He(n,i,l));const r=l=>R(o[l],1,1,()=>{o[l]=null});return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=ce()},m(l,a){for(let c=0;c<o.length;c+=1)o[c].m(l,a);S(l,e,a),t=!0},p(l,a){if(a&2){i=l[1];let c;for(c=0;c<i.length;c+=1){const s=He(l,i,c);o[c]?(o[c].p(s,a),L(o[c],1)):(o[c]=Ae(s),o[c].c(),L(o[c],1),o[c].m(e.parentNode,e))}for(ee(),c=i.length;c<o.length;c+=1)r(c);te()}},i(l){if(!t){for(let a=0;a<i.length;a+=1)L(o[a]);t=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)R(o[a]);t=!1},d(l){Ze(o,l),l&&I(e)}}}function Ae(n){let e,t;return e=new qt({props:{reward:n[2]}}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),t=!0},p(i,o){const r={};o&2&&(r.reward=i[2]),e.$set(r)},i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){x(e,i)}}}function Bt(n){var w;let e,t,i,o,r,l,a,c=((w=n[0])==null?void 0:w.credits)+"",s,b,f,k,h,m=n[1]&&Oe(n);return{c(){e=_("ion-header"),e.innerHTML="<ion-toolbar><ion-title>Rewards</ion-title></ion-toolbar>",t=M(),i=_("ion-content"),o=_("ion-list"),r=_("ion-list-header"),l=_("h2"),a=W("You have "),s=W(c),b=M(),f=_("ion-icon"),k=M(),m&&m.c(),g(e,"translucent",""),$(f,"color","green"),$(f,"font-size","32px"),$(f,"padding-left","3px"),g(f,"name","leaf-outline")},m(p,d){S(p,e,d),S(p,t,d),S(p,i,d),u(i,o),u(o,r),u(r,l),u(l,a),u(l,s),u(r,b),u(r,f),u(o,k),m&&m.m(o,null),h=!0},p(p,[d]){var T;(!h||d&1)&&c!==(c=((T=p[0])==null?void 0:T.credits)+"")&&G(s,c),p[1]?m?(m.p(p,d),d&2&&L(m,1)):(m=Oe(p),m.c(),L(m,1),m.m(o,null)):m&&(ee(),R(m,1,1,()=>{m=null}),te())},i(p){h||(L(m),h=!0)},o(p){R(m),h=!1},d(p){p&&I(e),p&&I(t),p&&I(i),m&&m.d()}}}function Vt(n,e,t){let i,o;return Q(n,K,r=>t(0,i=r)),Q(n,we,r=>t(1,o=r)),[i,o]}class Gt extends Y{constructor(e){super();Z(this,e,Vt,Bt,J,{})}}function Yt(n){let e,t,i,o,r,l,a,c;return{c(){e=_("ion-list"),t=_("ion-item"),t.innerHTML=`Logout
        <ion-icon name="log-out-outline" slot="end"></ion-icon>`,i=M(),o=_("ion-item"),o.innerHTML=`about
        <ion-icon name="information-circle-outline" slot="end"></ion-icon>`,r=M(),l=_("ion-item"),l.innerHTML=`GitHub Repo
        <ion-icon name="logo-github" slot="end"></ion-icon>`,g(t,"button",""),g(o,"button",""),g(l,"lines","none"),g(l,"button",""),g(e,"lines","n")},m(s,b){S(s,e,b),u(e,t),u(e,i),u(e,o),u(e,r),u(e,l),a||(c=[N(t,"click",n[1]),N(o,"click",n[2]),N(l,"click",n[3])],a=!0)},p:D,i:D,o:D,d(s){s&&I(e),a=!1,ae(c)}}}function Zt(n){let e=document.querySelector("ion-popover");const t=l=>{e==null||e.dismiss(l)};return[t,()=>{t("logout")},()=>{t("about")},()=>{t("github")}]}class Jt extends Y{constructor(e){super();Z(this,e,Zt,Yt,J,{})}}const Kt=function(n){return document.createElement(n).constructor!==HTMLElement},Qt=(n,e)=>{Kt(n)||ct(n,e,[])},jt=(n,e,t,i)=>(Qt(e,t),at.create({component:e,event:n,componentProps:i}).then(o=>(o.present(),o.onWillDismiss()))),Xt=()=>!!oe().currentUser,xt=()=>{var n;return((n=oe().currentUser)==null?void 0:n.email)||null},en=async(n,e)=>{try{return await ut(oe(),n,e),!0}catch(t){return console.log("Failed to login"),console.log(t),!1}},tn=()=>oe().signOut(),nn=async(n,e,t)=>{try{return await ft(oe(),e,t),await ie.updateUser({email:e,name:n,credits:100,redeemedRewards:[],trips:[]}),!0}catch(i){return console.log("Failed to sign up"),console.log(i),!1}};var se={logout:tn,login:en,getCurrentUser:xt,isLoggedIn:Xt,signUp:nn};function on(n){let e,t,i;return{c(){e=_("div"),Me(e,"class","map svelte-lgm8ca"),$(e,"height","100%"),$(e,"width","100%")},m(o,r){S(o,e,r),t||(i=[N(window,"resize",n[1]),Ye(n[0].call(null,e))],t=!0)},p:D,i:D,o:D,d(o){o&&I(e),t=!1,ae(i)}}}function rn(n,e,t){let{trip:i}=e,o=null,r=null,l=null,a=null;const c=f=>(o=q.map(f,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(o),o.setView([45.504755,-73.612572],14),{destroy:()=>{o==null||o.remove(),o=null}}),s=()=>o==null?void 0:o.invalidateSize(),b=()=>{if(!o)return;const f=i.geopoints.sort((k,h)=>k.timestamp<h.timestamp?-1:1).map(k=>[k.location.latitude,k.location.longitude]);l=q.circleMarker(f[0],{color:"red",weight:2,opacity:.7}),a=q.circleMarker(f[f.length-1],{color:"red",weight:2,opacity:.7}),r=q.polyline(f,{color:"red",weight:3,opacity:.5,smoothFactor:1}),l.addTo(o),a.addTo(o),r.addTo(o)};return me(()=>{setTimeout(async()=>{if(i){var f=St(i);o==null||o.setView([f.latitude,f.longitude]),b()}s()},1e3)}),n.$$set=f=>{"trip"in f&&t(2,i=f.trip)},[c,s,i]}class ln extends Y{constructor(e){super();Z(this,e,rn,on,J,{trip:2})}}function We(n){let e,t,i;return t=new ln({props:{trip:n[0]}}),{c(){e=_("ion-modal"),j(t.$$.fragment),g(e,"is-open","")},m(o,r){S(o,e,r),X(t,e,null),i=!0},p(o,r){const l={};r&1&&(l.trip=o[0]),t.$set(l)},i(o){i||(L(t.$$.fragment,o),i=!0)},o(o){R(t.$$.fragment,o),i=!1},d(o){o&&I(e),x(t)}}}function sn(n){let e,t,i,o,r,l=ye(n[0].geopoints).toLocaleString(void 0,{maximumFractionDigits:0})+" m",a,c,s,b,f,k,h,m,w,p,d=n[3]&&We(n);return{c(){e=_("ion-item"),t=_("ion-icon"),o=M(),r=_("ion-label"),a=W(l),c=M(),s=_("ion-button"),b=W("Delete"),k=M(),d&&d.c(),h=ce(),g(t,"name",i=ke(n[0].transportType)),g(t,"slot","start"),s.hidden=f=!n[1]},m(T,C){S(T,e,C),u(e,t),u(e,o),u(e,r),u(r,a),u(e,c),u(e,s),u(s,b),n[7](e),S(T,k,C),d&&d.m(T,C),S(T,h,C),m=!0,w||(p=[N(r,"click",n[5]),N(s,"click",n[6])],w=!0)},p(T,[C]){(!m||C&1&&i!==(i=ke(T[0].transportType)))&&g(t,"name",i),(!m||C&1)&&l!==(l=ye(T[0].geopoints).toLocaleString(void 0,{maximumFractionDigits:0})+" m")&&G(a,l),(!m||C&2&&f!==(f=!T[1]))&&(s.hidden=f),T[3]?d?(d.p(T,C),C&8&&L(d,1)):(d=We(T),d.c(),L(d,1),d.m(h.parentNode,h)):d&&(ee(),R(d,1,1,()=>{d=null}),te())},i(T){m||(L(d),m=!0)},o(T){R(d),m=!1},d(T){T&&I(e),n[7](null),T&&I(k),d&&d.d(T),T&&I(h),w=!1,ae(p)}}}function an(n,e,t){let{trip:i}=e,{editable:o=!1}=e,r;function l(){ie.deleteTrip(i.id)}let a=!1;function c(f){t(3,a=!0)}const s=()=>{var f;l(),(f=r==null?void 0:r.parentNode)==null||f.removeChild(r)};function b(f){ne[f?"unshift":"push"](()=>{r=f,t(2,r)})}return n.$$set=f=>{"trip"in f&&t(0,i=f.trip),"editable"in f&&t(1,o=f.editable)},[i,o,r,a,l,c,s,b]}class cn extends Y{constructor(e){super();Z(this,e,an,sn,J,{trip:0,editable:1})}}function qe(n,e,t){const i=n.slice();return i[6]=e[t],i}function un(n){let e,t,i,o,r,l;return{c(){e=_("ion-item"),t=_("ion-label"),t.textContent="Failed to load user",i=M(),o=_("ion-button"),o.textContent="Go back to login page",g(o,"slot","end"),g(o,"fill","outline")},m(a,c){S(a,e,c),u(e,t),u(e,i),u(e,o),r||(l=N(o,"click",n[5]),r=!0)},p:D,i:D,o:D,d(a){a&&I(e),r=!1,l()}}}function fn(n){let e,t,i,o,r,l=[],a=new Map,c,s,b,f,k,h=n[1].trips;const m=p=>p[6].id;for(let p=0;p<h.length;p+=1){let d=qe(n,h,p),T=m(d);a.set(T,l[p]=Be(T,d))}let w=!n[1].trips.length&&Ve();return{c(){e=_("ion-list-header"),t=_("ion-label"),t.textContent="Trips",i=M(),o=_("ion-button"),o.textContent="Edit",r=M();for(let p=0;p<l.length;p+=1)l[p].c();c=M(),w&&w.c(),s=ce()},m(p,d){S(p,e,d),u(e,t),u(e,i),u(e,o),S(p,r,d);for(let T=0;T<l.length;T+=1)l[T].m(p,d);S(p,c,d),w&&w.m(p,d),S(p,s,d),b=!0,f||(k=N(o,"click",n[4]),f=!0)},p(p,d){d&3&&(h=p[1].trips,ee(),l=pt(l,d,m,1,p,h,a,c.parentNode,mt,Be,c,qe),te()),p[1].trips.length?w&&(w.d(1),w=null):w||(w=Ve(),w.c(),w.m(s.parentNode,s))},i(p){if(!b){for(let d=0;d<h.length;d+=1)L(l[d]);b=!0}},o(p){for(let d=0;d<l.length;d+=1)R(l[d]);b=!1},d(p){p&&I(e),p&&I(r);for(let d=0;d<l.length;d+=1)l[d].d(p);p&&I(c),w&&w.d(p),p&&I(s),f=!1,k()}}}function Be(n,e){let t,i,o;return i=new cn({props:{editable:e[0],trip:e[6]}}),{key:n,first:null,c(){t=ce(),j(i.$$.fragment),this.first=t},m(r,l){S(r,t,l),X(i,r,l),o=!0},p(r,l){e=r;const a={};l&1&&(a.editable=e[0]),l&2&&(a.trip=e[6]),i.$set(a)},i(r){o||(L(i.$$.fragment,r),o=!0)},o(r){R(i.$$.fragment,r),o=!1},d(r){r&&I(t),x(i,r)}}}function Ve(n){let e;return{c(){e=_("ion-item"),e.innerHTML='<ion-label color="medium">You don&#39;t have any trips yets</ion-label>',g(e,"lines","none")},m(t,i){S(t,e,i)},d(t){t&&I(e)}}}function dn(n){let e,t,i,o,r,l,a=(n[1]?n[1].name:"Profile")+"",c,s,b,f,k,h,m,w,p,d,T;const C=[fn,un],y=[];function z(v,E){return v[1]?0:1}return m=z(n),w=y[m]=C[m](n),{c(){e=_("ion-header"),t=_("ion-toolbar"),i=_("ion-buttons"),o=_("ion-button"),o.innerHTML='<ion-icon slot="icon-only" ios="ellipsis-horizontal" md="ellipsis-vertical"></ion-icon>',r=M(),l=_("ion-title"),c=W(a),s=M(),b=_("ion-content"),f=_("div"),k=M(),h=_("ion-list"),w.c(),g(i,"slot","primary"),g(e,"translucent",""),Me(f,"class","summary-map")},m(v,E){S(v,e,E),u(e,t),u(t,i),u(i,o),u(t,r),u(t,l),u(l,c),S(v,s,E),S(v,b,E),u(b,f),u(b,k),u(b,h),y[m].m(h,null),p=!0,d||(T=N(o,"click",n[2]),d=!0)},p(v,[E]){(!p||E&2)&&a!==(a=(v[1]?v[1].name:"Profile")+"")&&G(c,a);let B=m;m=z(v),m===B?y[m].p(v,E):(ee(),R(y[B],1,1,()=>{y[B]=null}),te(),w=y[m],w?w.p(v,E):(w=y[m]=C[m](v),w.c()),L(w,1),w.m(h,null))},i(v){p||(L(w),p=!0)},o(v){R(w),p=!1},d(v){v&&I(e),v&&I(s),v&&I(b),y[m].d(),d=!1,T()}}}function pn(n,e,t){let i;Q(n,K,s=>t(1,i=s));let o=!1;function r(s){jt(s,"popover-extra",Jt,{}).then(async b=>{switch(b.data){case"logout":await se.logout();break;case"github":await dt.open({url:"http://github.com/marr11317/bhackcycle"})}})}function l(){t(0,o=!o)}return[o,i,r,l,()=>l(),()=>se.logout()]}class mn extends Y{constructor(e){super();Z(this,e,pn,dn,J,{})}}function _n(n){let e,t,i,o,r,l,a,c,s,b,f,k,h;return o=new Ot({}),a=new Gt({}),b=new mn({}),{c(){e=_("ion-app"),t=_("ion-tabs"),i=_("ion-tab"),j(o.$$.fragment),r=M(),l=_("ion-tab"),j(a.$$.fragment),c=M(),s=_("ion-tab"),j(b.$$.fragment),f=M(),k=_("ion-tab-bar"),k.innerHTML=`<ion-tab-button tab="map"><ion-label>Map</ion-label> 
        <ion-icon name="bicycle-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="rewards"><ion-label>Rewards</ion-label> 
        <ion-icon name="trophy-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="profile"><ion-label>profile</ion-label> 
        <ion-icon name="analytics-outline"></ion-icon></ion-tab-button>`,g(i,"tab","map"),g(l,"tab","rewards"),g(s,"tab","profile"),g(k,"slot","bottom")},m(m,w){S(m,e,w),u(e,t),u(t,i),X(o,i,null),u(t,r),u(t,l),X(a,l,null),u(t,c),u(t,s),X(b,s,null),u(t,f),u(t,k),h=!0},p:D,i(m){h||(L(o.$$.fragment,m),L(a.$$.fragment,m),L(b.$$.fragment,m),h=!0)},o(m){R(o.$$.fragment,m),R(a.$$.fragment,m),R(b.$$.fragment,m),h=!1},d(m){m&&I(e),x(o),x(a),x(b)}}}function bn(n,e,t){let i,o;return Q(n,we,r=>t(0,i=r)),Q(n,K,r=>t(1,o=r)),me(async()=>{const r=await ie.fetchUser(se.getCurrentUser());le(K,o=r,o);const l=await ie.fetchAllRewards();le(we,i=l,i)}),K.subscribe(async r=>{r&&await ie.updateUser(r)}),[]}class gn extends Y{constructor(e){super();Z(this,e,bn,_n,J,{})}}function Ge(n){let e,t,i,o;const r=[wn,hn],l=[];function a(c,s){return c[3]?1:0}return e=a(n),t=l[e]=r[e](n),{c(){t.c(),i=ce()},m(c,s){l[e].m(c,s),S(c,i,s),o=!0},p(c,s){let b=e;e=a(c),e===b?l[e].p(c,s):(ee(),R(l[b],1,1,()=>{l[b]=null}),te(),t=l[e],t?t.p(c,s):(t=l[e]=r[e](c),t.c()),L(t,1),t.m(i.parentNode,i))},i(c){o||(L(t),o=!0)},o(c){R(t),o=!1},d(c){l[e].d(c),c&&I(i)}}}function hn(n){let e,t;return e=new gn({}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),t=!0},p:D,i(i){t||(L(e.$$.fragment,i),t=!0)},o(i){R(e.$$.fragment,i),t=!1},d(i){x(e,i)}}}function wn(n){let e,t,i;function o(l){n[5](l)}let r={errorNote:n[2]};return n[1]!==void 0&&(r.signup=n[1]),e=new kt({props:r}),ne.push(()=>_t(e,"signup",o)),e.$on("submit",n[4]),{c(){j(e.$$.fragment)},m(l,a){X(e,l,a),i=!0},p(l,a){const c={};a&4&&(c.errorNote=l[2]),!t&&a&2&&(t=!0,c.signup=l[1],bt(()=>t=!1)),e.$set(c)},i(l){i||(L(e.$$.fragment,l),i=!0)},o(l){R(e.$$.fragment,l),i=!1},d(l){x(e,l)}}}function yn(n){let e,t,i=n[0]&&Ge(n);return{c(){e=_("ion-app"),i&&i.c()},m(o,r){S(o,e,r),i&&i.m(e,null),t=!0},p(o,[r]){o[0]?i?(i.p(o,r),r&1&&L(i,1)):(i=Ge(o),i.c(),L(i,1),i.m(e,null)):i&&(ee(),R(i,1,1,()=>{i=null}),te())},i(o){t||(L(i),t=!0)},o(o){R(i),t=!1},d(o){o&&I(e),i&&i.d()}}}function kn(n,e,t,i,o){return o&&t!==i?"Passwords do not match":""}function vn(n,e,t){let i;Q(n,fe,s=>t(3,i=s)),me(()=>{gt({apiKey:"AIzaSyClWb9snAaau0p3gWecoCVMywUwIKgP7Eo",authDomain:"hackatown-2022.firebaseapp.com",projectId:"hackatown-2022",storageBucket:"hackatown-2022.appspot.com",messagingSenderId:"410454368204",appId:"1:410454368204:web:16fa9750c1621761564769"}),oe().onAuthStateChanged(s=>{le(fe,i=!!s,i),t(0,o=!0)})});let o=!1,r=!1,l="";async function a(s){const{name:b,email:f,password:k,confirmPassword:h,signup:m}=s.detail,w=kn(b,f,k,h,m);if(w!=""){t(2,l=w);return}m?await se.signUp(b,f,k)?(t(2,l=""),le(fe,i=!0,i)):t(2,l="Signup failed"):await se.login(f,k)?(t(2,l=""),le(fe,i=!0,i)):t(2,l="Invalid email or password")}function c(s){r=s,t(1,r)}return[o,r,l,i,a,c]}class Tn extends Y{constructor(e){super();Z(this,e,vn,yn,J,{})}}new Tn({target:document.body});
