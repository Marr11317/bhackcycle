var Qe=Object.defineProperty,je=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var Le=(t,e,n)=>e in t?Qe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_e=(t,e)=>{for(var n in e||(e={}))ze.call(e,n)&&Le(t,n,e[n]);if(ce)for(var n of ce(e))Ee.call(e,n)&&Le(t,n,e[n]);return t},be=(t,e)=>je(t,Xe(e));var ge=(t,e)=>{var n={};for(var i in t)ze.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&ce)for(var i of ce(t))e.indexOf(i)<0&&Ee.call(t,i)&&(n[i]=t[i]);return n};import{S as Z,i as Y,s as J,e as p,t as W,a as v,b as d,c as G,d as T,f as b,n as R,l as U,g as S,h as N,j as xe,r as ae,k as et,m as ee,w as fe,o as tt,p as he,q as ve,N as Te,U as nt,u as it,v as Se,D as Ie,E as ot,x as Me,y as Ve,z as Q,A as pe,B as rt,G as lt,L as q,C as Ge,F as De,H as me,I as L,J as j,K as X,M as E,O as x,P as ne,Q as ie,R as st,T as at,V as ct,W as oe,X as ut,Y as dt,Z as ft,_ as pt,$ as mt,a0 as le,a1 as _t,a2 as bt,a3 as gt}from"./vendor.20d980e1.js";const ht=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};ht();function Ue(t){let e,n,i;return{c(){e=p("ion-item"),n=p("ion-label"),i=W(t[1])},m(o,r){v(o,e,r),d(e,n),d(n,i)},p(o,r){r&2&&G(i,o[1])},d(o){o&&T(e)}}}function Ne(t){let e,n;return{c(){e=p("ion-item"),n=p("ion-input"),b(n,"placeholder","Full Name"),b(n,"type","text"),b(n,"required","")},m(i,o){v(i,e,o),d(e,n),t[8](n)},p:R,d(i){i&&T(e),t[8](null)}}}function Fe(t){let e,n,i,o;return{c(){e=p("ion-item"),n=p("ion-input"),b(n,"placeholder","confirm password"),b(n,"type","password"),b(n,"required","")},m(r,l){v(r,e,l),d(e,n),t[11](n),i||(o=U(n,"keypress",t[7]),i=!0)},p:R,d(r){r&&T(e),t[11](null),i=!1,o()}}}function wt(t){let e,n,i,o=t[0]?"Sign up":"Login",r,l,a,c,s,f,m,w,h,u,_,g,k,A,y,M=t[0]?"Sign up":"Login",C,I,z,B=t[0]?"Login instead":"Sign up instead",F,V,Re,P=t[1]!==""&&Ue(t),$=t[0]&&Ne(t),O=t[0]&&Fe(t);return{c(){e=p("ion-header"),n=p("ion-toolbar"),i=p("ion-title"),r=W(o),l=S(),a=p("ion-icon"),c=S(),s=p("ion-list"),P&&P.c(),f=S(),$&&$.c(),m=S(),w=p("ion-item"),h=p("ion-input"),u=S(),_=p("ion-item"),g=p("ion-input"),k=S(),O&&O.c(),A=S(),y=p("ion-button"),C=W(M),I=S(),z=p("ion-button"),F=W(B),b(e,"translucent",""),N(a,"position","fixed"),N(a,"left","calc(50% - 64px)"),N(a,"margin-right","auto"),N(a,"top","15%"),N(a,"font-size","128px"),N(a,"color","lightgray"),b(a,"name","bicycle"),b(h,"placeholder","email"),b(h,"type","text"),b(h,"required",""),b(h,"autofocus",""),b(g,"placeholder","password"),b(g,"type","password"),b(g,"required",""),b(y,"expand","block"),b(s,"lines","full")},m(D,H){v(D,e,H),d(e,n),d(n,i),d(i,r),v(D,l,H),v(D,a,H),v(D,c,H),v(D,s,H),P&&P.m(s,null),d(s,f),$&&$.m(s,null),d(s,m),d(s,w),d(w,h),t[9](h),d(s,u),d(s,_),d(_,g),t[10](g),d(s,k),O&&O.m(s,null),d(s,A),d(s,y),d(y,C),v(D,I,H),v(D,z,H),d(z,F),h.focus(),V||(Re=[U(g,"keypress",function(){xe(t[0]?void 0:t[7])&&(t[0]?void 0:t[7]).apply(this,arguments)}),U(y,"click",t[6]),U(z,"click",t[12])],V=!0)},p(D,[H]){t=D,H&1&&o!==(o=t[0]?"Sign up":"Login")&&G(r,o),t[1]!==""?P?P.p(t,H):(P=Ue(t),P.c(),P.m(s,f)):P&&(P.d(1),P=null),t[0]?$?$.p(t,H):($=Ne(t),$.c(),$.m(s,m)):$&&($.d(1),$=null),t[0]?O?O.p(t,H):(O=Fe(t),O.c(),O.m(s,A)):O&&(O.d(1),O=null),H&1&&M!==(M=t[0]?"Sign up":"Login")&&G(C,M),H&1&&B!==(B=t[0]?"Login instead":"Sign up instead")&&G(F,B)},i:R,o:R,d(D){D&&T(e),D&&T(l),D&&T(a),D&&T(c),D&&T(s),P&&P.d(),$&&$.d(),t[9](null),t[10](null),O&&O.d(),D&&T(I),D&&T(z),V=!1,ae(Re)}}}function yt(t,e,n){const i=et();function o(){!c||!s||r&&!f||i("submit",{name:a?a.value:void 0,email:c.value,password:s.value,confirmPassword:f?f.value:void 0,signup:r})}let{signup:r=!1}=e,{errorNote:l=""}=e,a,c,s,f;function m(k){k.key==="Enter"&&o()}function w(k){ee[k?"unshift":"push"](()=>{a=k,n(2,a)})}function h(k){ee[k?"unshift":"push"](()=>{c=k,n(3,c)})}function u(k){ee[k?"unshift":"push"](()=>{s=k,n(4,s)})}function _(k){ee[k?"unshift":"push"](()=>{f=k,n(5,f)})}const g=()=>n(0,r=!r);return t.$$set=k=>{"signup"in k&&n(0,r=k.signup),"errorNote"in k&&n(1,l=k.errorNote)},[r,l,a,c,s,f,o,m,w,h,u,_,g]}class kt extends Z{constructor(e){super();Y(this,e,yt,wt,J,{signup:0,errorNote:1})}}const vt=(t,e)=>{const n=localStorage.getItem(t),i=fe(n?JSON.parse(n):e);return i.subscribe(o=>localStorage.setItem(t,o?JSON.stringify(o):"")),i},ue=fe(!1),K=fe(null),we=fe(null),de=vt("currentTrip",null),Tt=t=>{de.update(e=>e?(e.geopoints=[...e.geopoints,{timestamp:new Date().toISOString(),location:t}],e):null)},ye=t=>{if(!t.length)return 0;let e=0;for(let n=1;n<t.length-1;++n)e+=tt(t[n-1].location,t[n].location);return e},St=t=>{let e=t.geopoints.map(n=>({latitude:n.location.latitude,longitude:n.location.longitude})).reduce((n,i)=>({latitude:n.latitude+i.latitude,longitude:i.longitude+n.longitude}));return e.latitude/=t.geopoints.length,e.longitude/=t.geopoints.length,e},It={toFirestore:t=>({name:t.name,email:t.email,credits:t.credits,redeemedRewards:t.redeemedRewards}),fromFirestore:(t,e)=>{const n=t.data(e);return{name:n.name,email:n.email,credits:n.credits,redeemedRewards:n.redeemedRewards}}},Ce={toFirestore:t=>({id:t.id,userEmail:t.userEmail,startTime:he.fromDate(t.startTime),endTime:t.endTime?he.fromDate(t.endTime):null,transportType:t.transportType,distance:t.distance,geopoints:t.geopoints}),fromFirestore:(t,e)=>{const n=t.data(e);return{id:n.id,userEmail:n.userEmail,startTime:n.startTime.toDate(),endTime:n.endTime?n.endTime.toDate():null,transportType:n.transportType,distance:n.distance,geopoints:n.geopoints}}},Ze={toFirestore:t=>({id:t.id,name:t.name,description:t.description,price:t.price,provider:t.provider,expiration:he.fromDate(t.expiration),remainingUnits:t.remainingUnits}),fromFirestore:(t,e)=>{const n=t.data(e);return{id:n.id,name:n.name,description:n.description,price:n.price,provider:n.provider,expiration:n.expiration.toDate(),remainingUnits:n.remainingUnits}}},re=()=>nt(),Ye=t=>Te(re(),"users",t).withConverter(It),Mt=t=>Te(re(),"trips",t.id).withConverter(Ce),Ct=t=>Te(re(),"rewards",t.id).withConverter(Ze),Rt=async t=>{const o=t,{redeemedRewards:e}=o,n=ge(o,["redeemedRewards"]),i=be(_e({},n),{redeemedRewards:e.map(r=>r.id)});await ve(Ye(t.email),i)},Lt=async t=>{await ve(Mt(t),t)},zt=async t=>{await ve(Ct(t),t)},Et=async t=>{const e=await it(Ye(t));if(!e.exists())return null;const n=e.data(),a=n,{redeemedRewards:i}=a,o=ge(a,["redeemedRewards"]),r=await Dt(n.email),l=(await Je()).filter(c=>(i||[]).includes(c.id));return be(_e({},o),{trips:r,redeemedRewards:l})},Dt=async t=>{const e=[];return(await Se(Ie(re(),"trips").withConverter(Ce))).forEach(i=>i.exists()&&e.push(i.data())),e.filter(i=>i.userEmail===t)},Ut=async t=>{(await Se(Ie(re(),"trips").withConverter(Ce))).forEach(n=>{n.exists()&&n.data().id===t&&ot(n.ref)})},Je=async()=>{const t=[];return(await Se(Ie(re(),"rewards").withConverter(Ze))).forEach(n=>n.exists()&&t.push(n.data())),t};var te={fetchUser:Et,fetchAllRewards:Je,updateUser:Rt,updateTrip:Lt,updateReward:zt,deleteTrip:Ut};function ke(t){switch(t){case"bicycle":return"bicycle";case"walk":return"walk";case"publicTransport":return"bus";default:return"walk"}}const{window:Nt}=rt;function Pe(t,e,n){const i=t.slice();return i[16]=e[n],i}function Ft(t){let e,n,i,o,r=t[5],l=[];for(let a=0;a<r.length;a+=1)l[a]=$e(Pe(t,r,a));return{c(){e=p("ion-fab"),n=p("ion-fab-button"),n.innerHTML='<ion-icon name="add"></ion-icon>',i=S(),o=p("ion-fab-list");for(let a=0;a<l.length;a+=1)l[a].c();b(o,"side","top"),b(e,"horizontal","center"),b(e,"vertical","bottom"),b(e,"slot","fixed")},m(a,c){v(a,e,c),d(e,n),d(e,i),d(e,o);for(let s=0;s<l.length;s+=1)l[s].m(o,null)},p(a,c){if(c&48){r=a[5];let s;for(s=0;s<r.length;s+=1){const f=Pe(a,r,s);l[s]?l[s].p(f,c):(l[s]=$e(f),l[s].c(),l[s].m(o,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=r.length}},d(a){a&&T(e),Ge(l,a)}}}function Pt(t){let e,n,i;return{c(){e=p("ion-fab"),e.innerHTML='<ion-fab-button><ion-icon name="close"></ion-icon></ion-fab-button>',b(e,"horizontal","center"),b(e,"vertical","bottom"),b(e,"slot","fixed")},m(o,r){v(o,e,r),n||(i=U(e,"click",t[3]),n=!0)},p:R,d(o){o&&T(e),n=!1,i()}}}function $e(t){let e,n,i,o,r,l;function a(){return t[6](t[16])}return{c(){e=p("ion-fab-button"),n=p("ion-icon"),o=S(),b(n,"name",i=ke(t[16]))},m(c,s){v(c,e,s),d(e,n),d(e,o),r||(l=U(e,"click",a),r=!0)},p(c,s){t=c},d(c){c&&T(e),r=!1,l()}}}function $t(t){let e,n,i,o,r;function l(s,f){return s[0]?Pt:Ft}let a=l(t),c=a(t);return{c(){e=p("ion-content"),c.c(),n=S(),i=p("div"),Me(i,"class","map svelte-vsoji2"),N(i,"height","100%"),N(i,"width","100%")},m(s,f){v(s,e,f),c.m(e,null),d(e,n),d(e,i),o||(r=[U(Nt,"resize",t[2]),Ve(t[1].call(null,i))],o=!0)},p(s,[f]){a===(a=l(s))&&c?c.p(s,f):(c.d(1),c=a(s),c&&(c.c(),c.m(e,n)))},i:R,o:R,d(s){s&&T(e),c.d(),o=!1,ae(r)}}}function Ot(t,e,n){let i,o;Q(t,de,y=>n(0,i=y)),Q(t,K,y=>n(12,o=y));let r=null,l=null,a=null,c=null;const s=async()=>{const y=await lt.getCurrentPosition();return{lat:y.coords.latitude,lng:y.coords.longitude}},f=y=>(r=q.map(y,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(r),r.setView([45.504755,-73.612572],14),{destroy:()=>{r==null||r.remove(),r=null}}),m=()=>r==null?void 0:r.invalidateSize(),w=async y=>{!r||(a==null||a.removeFrom(r),l==null||l.removeFrom(r),c=q.circleMarker(y,{color:"red",weight:2,opacity:.7}),a=q.circleMarker(y,{color:"red",weight:2,opacity:.7}),l=q.polyline([y],{color:"red",weight:3,opacity:.5,smoothFactor:1}),c.addTo(r),a.addTo(r),l.addTo(r))},h=()=>{if(!r||!(i==null?void 0:i.geopoints.length))return;const y=i.geopoints.sort((M,C)=>M.timestamp<C.timestamp?-1:1).map(M=>[M.location.latitude,M.location.longitude]);a=q.circleMarker(y[0],{color:"red",weight:2,opacity:.7}),c=q.circleMarker(y[y.length-1],{color:"red",weight:2,opacity:.7}),l=q.polyline(y,{color:"red",weight:3,opacity:.5,smoothFactor:1}),a.addTo(r),c.addTo(r),l.addTo(r)};let u=null;const _=()=>{if(u&&(clearInterval(u),u=null),!i)return;const y=ye(i.geopoints),M={id:i.id,userEmail:i.userEmail,transportType:i.transportType,startTime:new Date(i.startTime),endTime:new Date,distance:y,geopoints:i.geopoints.map(({location:C,timestamp:I})=>({location:C,timestamp:I}))};te.updateTrip(M),de.set(null),r&&(l==null||l.removeFrom(r),a==null||a.removeFrom(r),c==null||c.removeFrom(r)),K.update(C=>C?(C.credits+=Math.floor(.28*y/1e3),C.trips=[...C.trips,M],C):null)},g=async y=>{de.set({id:Date.now().toString(),userEmail:o.email,startTime:new Date().toISOString(),transportType:y,geopoints:[]});const M=await s();w(M),u=window.setInterval(async()=>{if(!i)return;const C=await s();Tt({latitude:C.lat,longitude:C.lng}),i.geopoints.length==0?w(C):l==null||l.addLatLng(C)},3e3)};return pe(()=>{setTimeout(async()=>{const y=await s();r==null||r.setView(y),(i==null?void 0:i.geopoints.length)&&h(),m()},300)}),[i,f,m,_,g,["publicTransport","walk","bicycle"],y=>g(y)]}class Ht extends Z{constructor(e){super();Y(this,e,Ot,$t,J,{})}}function Wt(t){let e,n,i,o=t[0].name+"",r,l,a,c=t[0].description+"",s,f,m,w,h=t[0].price+"",u,_,g,k,A,y,M=t[0].expiration?`Expires on ${t[0].expiration.toDateString()}`:"",C,I,z,B;return{c(){e=p("ion-card"),n=p("ion-card-header"),i=p("ion-card-title"),r=W(o),l=S(),a=p("ion-card-subtitle"),s=W(c),f=S(),m=p("ion-card-content"),w=W("Cost: "),u=W(h),_=S(),g=p("ion-icon"),k=S(),A=p("br"),y=S(),C=W(M),b(a,"class","sub svelte-aab9bb"),N(g,"color","green"),N(g,"font-size","16px"),N(g,"padding-left","3px"),b(g,"name","leaf-outline"),b(m,"class","content svelte-aab9bb"),b(e,"class",I=De(t[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")},m(F,V){v(F,e,V),d(e,n),d(n,i),d(i,r),d(n,l),d(n,a),d(a,s),d(e,f),d(e,m),d(m,w),d(m,u),d(m,_),d(m,g),d(m,k),d(m,A),d(m,y),d(m,C),z||(B=U(e,"click",t[3]),z=!0)},p(F,[V]){V&1&&o!==(o=F[0].name+"")&&G(r,o),V&1&&c!==(c=F[0].description+"")&&G(s,c),V&1&&h!==(h=F[0].price+"")&&G(u,h),V&1&&M!==(M=F[0].expiration?`Expires on ${F[0].expiration.toDateString()}`:"")&&G(C,M),V&2&&I!==(I=De(F[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")&&b(e,"class",I)},i:R,o:R,d(F){F&&T(e),z=!1,B()}}}function At(t,e,n){let i;Q(t,K,s=>n(4,i=s));let{reward:o}=e,r=(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1;function l(){!i||a()||!o.remainingUnits||i.credits<o.price||(K.update(s=>s&&(n(1,r=!0),s.credits-=o.price,s.redeemedRewards=[...s.redeemedRewards,o],s)),n(0,o.remainingUnits--,o))}function a(){return(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1}const c=()=>l();return t.$$set=s=>{"reward"in s&&n(0,o=s.reward)},[o,r,l,c]}class qt extends Z{constructor(e){super();Y(this,e,At,Wt,J,{reward:0})}}function Oe(t,e,n){const i=t.slice();return i[2]=e[n],i}function He(t){let e,n,i=t[1],o=[];for(let l=0;l<i.length;l+=1)o[l]=We(Oe(t,i,l));const r=l=>E(o[l],1,1,()=>{o[l]=null});return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=me()},m(l,a){for(let c=0;c<o.length;c+=1)o[c].m(l,a);v(l,e,a),n=!0},p(l,a){if(a&2){i=l[1];let c;for(c=0;c<i.length;c+=1){const s=Oe(l,i,c);o[c]?(o[c].p(s,a),L(o[c],1)):(o[c]=We(s),o[c].c(),L(o[c],1),o[c].m(e.parentNode,e))}for(ne(),c=i.length;c<o.length;c+=1)r(c);ie()}},i(l){if(!n){for(let a=0;a<i.length;a+=1)L(o[a]);n=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)E(o[a]);n=!1},d(l){Ge(o,l),l&&T(e)}}}function We(t){let e,n;return e=new qt({props:{reward:t[2]}}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),n=!0},p(i,o){const r={};o&2&&(r.reward=i[2]),e.$set(r)},i(i){n||(L(e.$$.fragment,i),n=!0)},o(i){E(e.$$.fragment,i),n=!1},d(i){x(e,i)}}}function Bt(t){var _;let e,n,i,o,r,l,a,c=((_=t[0])==null?void 0:_.credits)+"",s,f,m,w,h,u=t[1]&&He(t);return{c(){e=p("ion-header"),e.innerHTML="<ion-toolbar><ion-title>Rewards</ion-title></ion-toolbar>",n=S(),i=p("ion-content"),o=p("ion-list"),r=p("ion-list-header"),l=p("h2"),a=W("You have "),s=W(c),f=S(),m=p("ion-icon"),w=S(),u&&u.c(),b(e,"translucent",""),N(m,"color","green"),N(m,"font-size","32px"),N(m,"padding-left","3px"),b(m,"name","leaf-outline")},m(g,k){v(g,e,k),v(g,n,k),v(g,i,k),d(i,o),d(o,r),d(r,l),d(l,a),d(l,s),d(r,f),d(r,m),d(o,w),u&&u.m(o,null),h=!0},p(g,[k]){var A;(!h||k&1)&&c!==(c=((A=g[0])==null?void 0:A.credits)+"")&&G(s,c),g[1]?u?(u.p(g,k),k&2&&L(u,1)):(u=He(g),u.c(),L(u,1),u.m(o,null)):u&&(ne(),E(u,1,1,()=>{u=null}),ie())},i(g){h||(L(u),h=!0)},o(g){E(u),h=!1},d(g){g&&T(e),g&&T(n),g&&T(i),u&&u.d()}}}function Vt(t,e,n){let i,o;return Q(t,K,r=>n(0,i=r)),Q(t,we,r=>n(1,o=r)),[i,o]}class Gt extends Z{constructor(e){super();Y(this,e,Vt,Bt,J,{})}}function Zt(t){let e,n,i,o,r,l,a,c;return{c(){e=p("ion-list"),n=p("ion-item"),n.innerHTML=`Logout
        <ion-icon name="log-out-outline" slot="end"></ion-icon>`,i=S(),o=p("ion-item"),o.innerHTML=`about
        <ion-icon name="information-circle-outline" slot="end"></ion-icon>`,r=S(),l=p("ion-item"),l.innerHTML=`GitHub Repo
        <ion-icon name="logo-github" slot="end"></ion-icon>`,b(n,"button",""),b(o,"button",""),b(l,"lines","none"),b(l,"button",""),b(e,"lines","n")},m(s,f){v(s,e,f),d(e,n),d(e,i),d(e,o),d(e,r),d(e,l),a||(c=[U(n,"click",t[1]),U(o,"click",t[2]),U(l,"click",t[3])],a=!0)},p:R,i:R,o:R,d(s){s&&T(e),a=!1,ae(c)}}}function Yt(t){let e=document.querySelector("ion-popover");const n=l=>{e==null||e.dismiss(l)};return[n,()=>{n("logout")},()=>{n("about")},()=>{n("github")}]}class Jt extends Z{constructor(e){super();Y(this,e,Yt,Zt,J,{})}}const Kt=function(t){return document.createElement(t).constructor!==HTMLElement},Ke=(t,e)=>{Kt(t)||at(t,e,[])},Qt=(t,e,n)=>(Ke(t,e),ct.create({component:t,componentProps:n}).then(i=>(i.present(),i.onWillDismiss()))),jt=(t,e,n,i)=>(Ke(e,n),st.create({component:e,event:t,componentProps:i}).then(o=>(o.present(),o.onWillDismiss()))),Xt=()=>!!oe().currentUser,xt=()=>{var t;return((t=oe().currentUser)==null?void 0:t.email)||null},en=async(t,e)=>{try{return await ut(oe(),t,e),!0}catch(n){return console.log("Failed to login"),console.log(n),!1}},tn=()=>oe().signOut(),nn=async(t,e,n)=>{try{return await dt(oe(),e,n),await te.updateUser({email:e,name:t,credits:100,redeemedRewards:[],trips:[]}),!0}catch(i){return console.log("Failed to sign up"),console.log(i),!1}};var se={logout:tn,login:en,getCurrentUser:xt,isLoggedIn:Xt,signUp:nn};function on(t){let e,n,i;return{c(){e=p("div"),Me(e,"class","map svelte-a80q7u"),N(e,"height","100%"),N(e,"width","100%")},m(o,r){v(o,e,r),n||(i=[U(window,"resize",t[1]),Ve(t[0].call(null,e))],n=!0)},p:R,i:R,o:R,d(o){o&&T(e),n=!1,ae(i)}}}function rn(t,e,n){let{trip:i}=e,o=null,r=null,l=null,a=null;const c=m=>(o=q.map(m,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(o),o.setView([45.504755,-73.612572],14),{destroy:()=>{o==null||o.remove(),o=null}}),s=()=>o==null?void 0:o.invalidateSize(),f=()=>{if(!o)return;const m=i.geopoints.sort((w,h)=>w.timestamp<h.timestamp?-1:1).map(w=>[w.location.latitude,w.location.longitude]);l=q.circleMarker(m[0],{color:"red",weight:2,opacity:.7}),a=q.circleMarker(m[m.length-1],{color:"red",weight:2,opacity:.7}),r=q.polyline(m,{color:"red",weight:3,opacity:.5,smoothFactor:1}),l.addTo(o),a.addTo(o),r.addTo(o)};return pe(()=>{setTimeout(async()=>{if(i){console.log(i);var m=St(i);o==null||o.setView([m.latitude,m.longitude]),f()}s()},300)}),t.$$set=m=>{"trip"in m&&n(2,i=m.trip)},[c,s,i]}class ln extends Z{constructor(e){super();Y(this,e,rn,on,J,{trip:2})}}function sn(t){let e,n,i,o,r,l=ye(t[0].geopoints)+"",a,c,s,f,m,w,h;return{c(){e=p("ion-item"),n=p("ion-icon"),o=S(),r=p("ion-label"),a=W(l),c=S(),s=p("ion-button"),f=W("Delete"),b(n,"name",i=ke(t[0].transportType)),b(n,"slot","start"),s.hidden=m=!t[1]},m(u,_){v(u,e,_),d(e,n),d(e,o),d(e,r),d(r,a),d(e,c),d(e,s),d(s,f),t[6](e),w||(h=[U(r,"click",t[4]),U(s,"click",t[5])],w=!0)},p(u,[_]){_&1&&i!==(i=ke(u[0].transportType))&&b(n,"name",i),_&1&&l!==(l=ye(u[0].geopoints)+"")&&G(a,l),_&2&&m!==(m=!u[1])&&(s.hidden=m)},i:R,o:R,d(u){u&&T(e),t[6](null),w=!1,ae(h)}}}function an(t,e,n){let{trip:i}=e,{editable:o=!1}=e,r;function l(){te.deleteTrip(i.id)}function a(f){Qt("summary-map",ln,{trip:i})}const c=()=>{var f;l(),(f=r==null?void 0:r.parentNode)==null||f.removeChild(r)};function s(f){ee[f?"unshift":"push"](()=>{r=f,n(2,r)})}return t.$$set=f=>{"trip"in f&&n(0,i=f.trip),"editable"in f&&n(1,o=f.editable)},[i,o,r,l,a,c,s]}class cn extends Z{constructor(e){super();Y(this,e,an,sn,J,{trip:0,editable:1})}}function Ae(t,e,n){const i=t.slice();return i[6]=e[n],i}function un(t){let e,n,i,o,r,l;return{c(){e=p("ion-item"),n=p("ion-label"),n.textContent="Failed to load user",i=S(),o=p("ion-button"),o.textContent="Go back to login page",b(o,"slot","end"),b(o,"fill","outline")},m(a,c){v(a,e,c),d(e,n),d(e,i),d(e,o),r||(l=U(o,"click",t[5]),r=!0)},p:R,i:R,o:R,d(a){a&&T(e),r=!1,l()}}}function dn(t){let e,n,i,o,r,l=[],a=new Map,c,s,f,m,w=t[1].trips;const h=u=>u[6].id;for(let u=0;u<w.length;u+=1){let _=Ae(t,w,u),g=h(_);a.set(g,l[u]=qe(g,_))}return{c(){e=p("ion-list-header"),n=p("ion-label"),n.textContent="Trips",i=S(),o=p("ion-button"),o.textContent="Edit",r=S();for(let u=0;u<l.length;u+=1)l[u].c();c=me()},m(u,_){v(u,e,_),d(e,n),d(e,i),d(e,o),v(u,r,_);for(let g=0;g<l.length;g+=1)l[g].m(u,_);v(u,c,_),s=!0,f||(m=U(o,"click",t[4]),f=!0)},p(u,_){_&3&&(w=u[1].trips,ne(),l=pt(l,_,h,1,u,w,a,c.parentNode,mt,qe,c,Ae),ie())},i(u){if(!s){for(let _=0;_<w.length;_+=1)L(l[_]);s=!0}},o(u){for(let _=0;_<l.length;_+=1)E(l[_]);s=!1},d(u){u&&T(e),u&&T(r);for(let _=0;_<l.length;_+=1)l[_].d(u);u&&T(c),f=!1,m()}}}function qe(t,e){let n,i,o;return i=new cn({props:{editable:e[0],trip:e[6]}}),{key:t,first:null,c(){n=me(),j(i.$$.fragment),this.first=n},m(r,l){v(r,n,l),X(i,r,l),o=!0},p(r,l){e=r;const a={};l&1&&(a.editable=e[0]),l&2&&(a.trip=e[6]),i.$set(a)},i(r){o||(L(i.$$.fragment,r),o=!0)},o(r){E(i.$$.fragment,r),o=!1},d(r){r&&T(n),x(i,r)}}}function fn(t){let e,n,i,o,r,l,a=(t[1]?t[1].name:"Profile")+"",c,s,f,m,w,h,u,_,g,k,A;const y=[dn,un],M=[];function C(I,z){return I[1]?0:1}return u=C(t),_=M[u]=y[u](t),{c(){e=p("ion-header"),n=p("ion-toolbar"),i=p("ion-buttons"),o=p("ion-button"),o.innerHTML='<ion-icon slot="icon-only" ios="ellipsis-horizontal" md="ellipsis-vertical"></ion-icon>',r=S(),l=p("ion-title"),c=W(a),s=S(),f=p("ion-content"),m=p("div"),w=S(),h=p("ion-list"),_.c(),b(i,"slot","primary"),b(e,"translucent",""),Me(m,"class","summary-map")},m(I,z){v(I,e,z),d(e,n),d(n,i),d(i,o),d(n,r),d(n,l),d(l,c),v(I,s,z),v(I,f,z),d(f,m),d(f,w),d(f,h),M[u].m(h,null),g=!0,k||(A=U(o,"click",t[2]),k=!0)},p(I,[z]){(!g||z&2)&&a!==(a=(I[1]?I[1].name:"Profile")+"")&&G(c,a);let B=u;u=C(I),u===B?M[u].p(I,z):(ne(),E(M[B],1,1,()=>{M[B]=null}),ie(),_=M[u],_?_.p(I,z):(_=M[u]=y[u](I),_.c()),L(_,1),_.m(h,null))},i(I){g||(L(_),g=!0)},o(I){E(_),g=!1},d(I){I&&T(e),I&&T(s),I&&T(f),M[u].d(),k=!1,A()}}}function pn(t,e,n){let i;Q(t,K,s=>n(1,i=s));let o=!1;function r(s){jt(s,"popover-extra",Jt,{}).then(async f=>{switch(f.data){case"logout":await se.logout();break;case"github":await ft.open({url:"http://github.com/marr11317/bhackcycle"})}})}function l(){n(0,o=!o)}return[o,i,r,l,()=>l(),()=>se.logout()]}class mn extends Z{constructor(e){super();Y(this,e,pn,fn,J,{})}}function _n(t){let e,n,i,o,r,l,a,c,s,f,m,w,h;return o=new Ht({}),a=new Gt({}),f=new mn({}),{c(){e=p("ion-app"),n=p("ion-tabs"),i=p("ion-tab"),j(o.$$.fragment),r=S(),l=p("ion-tab"),j(a.$$.fragment),c=S(),s=p("ion-tab"),j(f.$$.fragment),m=S(),w=p("ion-tab-bar"),w.innerHTML=`<ion-tab-button tab="map"><ion-label>Map</ion-label> 
        <ion-icon name="bicycle-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="rewards"><ion-label>Rewards</ion-label> 
        <ion-icon name="trophy-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="profile"><ion-label>profile</ion-label> 
        <ion-icon name="analytics-outline"></ion-icon></ion-tab-button>`,b(i,"tab","map"),b(l,"tab","rewards"),b(s,"tab","profile"),b(w,"slot","bottom")},m(u,_){v(u,e,_),d(e,n),d(n,i),X(o,i,null),d(n,r),d(n,l),X(a,l,null),d(n,c),d(n,s),X(f,s,null),d(n,m),d(n,w),h=!0},p:R,i(u){h||(L(o.$$.fragment,u),L(a.$$.fragment,u),L(f.$$.fragment,u),h=!0)},o(u){E(o.$$.fragment,u),E(a.$$.fragment,u),E(f.$$.fragment,u),h=!1},d(u){u&&T(e),x(o),x(a),x(f)}}}function bn(t,e,n){let i,o;return Q(t,we,r=>n(0,i=r)),Q(t,K,r=>n(1,o=r)),pe(async()=>{const r=await te.fetchUser(se.getCurrentUser());le(K,o=r,o);const l=await te.fetchAllRewards();le(we,i=l,i)}),K.subscribe(async r=>{r&&await te.updateUser(r)}),[]}class gn extends Z{constructor(e){super();Y(this,e,bn,_n,J,{})}}function Be(t){let e,n,i,o;const r=[wn,hn],l=[];function a(c,s){return c[3]?1:0}return e=a(t),n=l[e]=r[e](t),{c(){n.c(),i=me()},m(c,s){l[e].m(c,s),v(c,i,s),o=!0},p(c,s){let f=e;e=a(c),e===f?l[e].p(c,s):(ne(),E(l[f],1,1,()=>{l[f]=null}),ie(),n=l[e],n?n.p(c,s):(n=l[e]=r[e](c),n.c()),L(n,1),n.m(i.parentNode,i))},i(c){o||(L(n),o=!0)},o(c){E(n),o=!1},d(c){l[e].d(c),c&&T(i)}}}function hn(t){let e,n;return e=new gn({}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),n=!0},p:R,i(i){n||(L(e.$$.fragment,i),n=!0)},o(i){E(e.$$.fragment,i),n=!1},d(i){x(e,i)}}}function wn(t){let e,n,i;function o(l){t[5](l)}let r={errorNote:t[2]};return t[1]!==void 0&&(r.signup=t[1]),e=new kt({props:r}),ee.push(()=>_t(e,"signup",o)),e.$on("submit",t[4]),{c(){j(e.$$.fragment)},m(l,a){X(e,l,a),i=!0},p(l,a){const c={};a&4&&(c.errorNote=l[2]),!n&&a&2&&(n=!0,c.signup=l[1],bt(()=>n=!1)),e.$set(c)},i(l){i||(L(e.$$.fragment,l),i=!0)},o(l){E(e.$$.fragment,l),i=!1},d(l){x(e,l)}}}function yn(t){let e,n,i=t[0]&&Be(t);return{c(){e=p("ion-app"),i&&i.c()},m(o,r){v(o,e,r),i&&i.m(e,null),n=!0},p(o,[r]){o[0]?i?(i.p(o,r),r&1&&L(i,1)):(i=Be(o),i.c(),L(i,1),i.m(e,null)):i&&(ne(),E(i,1,1,()=>{i=null}),ie())},i(o){n||(L(i),n=!0)},o(o){E(i),n=!1},d(o){o&&T(e),i&&i.d()}}}function kn(t,e,n,i,o){return o&&n!==i?"Passwords do not match":""}function vn(t,e,n){let i;Q(t,ue,s=>n(3,i=s)),pe(()=>{gt({apiKey:"AIzaSyClWb9snAaau0p3gWecoCVMywUwIKgP7Eo",authDomain:"hackatown-2022.firebaseapp.com",projectId:"hackatown-2022",storageBucket:"hackatown-2022.appspot.com",messagingSenderId:"410454368204",appId:"1:410454368204:web:16fa9750c1621761564769"}),oe().onAuthStateChanged(s=>{le(ue,i=!!s,i),n(0,o=!0)})});let o=!1,r=!1,l="";async function a(s){const{name:f,email:m,password:w,confirmPassword:h,signup:u}=s.detail,_=kn(f,m,w,h,u);if(_!=""){n(2,l=_);return}u?await se.signUp(f,m,w)?(n(2,l=""),le(ue,i=!0,i)):n(2,l="Signup failed"):await se.login(m,w)?(n(2,l=""),le(ue,i=!0,i)):n(2,l="Invalid email or password")}function c(s){r=s,n(1,r)}return[o,r,l,i,a,c]}class Tn extends Z{constructor(e){super();Y(this,e,vn,yn,J,{})}}new Tn({target:document.body});
