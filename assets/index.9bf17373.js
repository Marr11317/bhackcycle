var je=Object.defineProperty,Xe=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var Ce=(n,e,t)=>e in n?je(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_e=(n,e)=>{for(var t in e||(e={}))ze.call(e,t)&&Ce(n,t,e[t]);if(ue)for(var t of ue(e))Ee.call(e,t)&&Ce(n,t,e[t]);return n},be=(n,e)=>Xe(n,xe(e));var ge=(n,e)=>{var t={};for(var i in n)ze.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&ue)for(var i of ue(n))e.indexOf(i)<0&&Ee.call(n,i)&&(t[i]=n[i]);return t};import{S as Y,i as Z,s as J,e as _,t as W,a as T,b as u,c as G,d as S,f as g,n as E,l as U,g as I,h as $,j as et,r as ae,k as tt,m as ne,w as pe,o as nt,p as he,q as ve,N as Te,U as it,u as ot,v as Se,D as Ie,E as rt,x as Me,y as Ye,z as Q,A as me,B as lt,G as st,L as q,C as Ze,F as De,H as ce,I as C,J as j,K as X,M as z,O as x,P as ee,Q as te,R as at,T as ct,V as oe,W as ut,X as ft,Y as dt,Z as pt,_ as mt,$ as le,a0 as _t,a1 as bt,a2 as gt}from"./vendor.68da5438.js";const ht=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}};ht();function Ne(n){let e,t,i;return{c(){e=_("ion-item"),t=_("ion-label"),i=W(n[1])},m(o,r){T(o,e,r),u(e,t),u(t,i)},p(o,r){r&2&&G(i,o[1])},d(o){o&&S(e)}}}function Ue(n){let e,t;return{c(){e=_("ion-item"),t=_("ion-input"),g(t,"placeholder","Full Name"),g(t,"type","text"),g(t,"required","")},m(i,o){T(i,e,o),u(e,t),n[8](t)},p:E,d(i){i&&S(e),n[8](null)}}}function $e(n){let e,t,i,o;return{c(){e=_("ion-item"),t=_("ion-input"),g(t,"placeholder","confirm password"),g(t,"type","password"),g(t,"required","")},m(r,l){T(r,e,l),u(e,t),n[11](t),i||(o=U(t,"keypress",n[7]),i=!0)},p:E,d(r){r&&S(e),n[11](null),i=!1,o()}}}function wt(n){let e,t,i,o=n[0]?"Sign up":"Login",r,l,a,c,s,b,p,v,h,m,y,d,f,k,w,L=n[0]?"Sign up":"Login",R,M,D,B=n[0]?"Login instead":"Sign up instead",F,V,Re,P=n[1]!==""&&Ne(n),H=n[0]&&Ue(n),O=n[0]&&$e(n);return{c(){e=_("ion-header"),t=_("ion-toolbar"),i=_("ion-title"),r=W(o),l=I(),a=_("ion-icon"),c=I(),s=_("ion-list"),P&&P.c(),b=I(),H&&H.c(),p=I(),v=_("ion-item"),h=_("ion-input"),m=I(),y=_("ion-item"),d=_("ion-input"),f=I(),O&&O.c(),k=I(),w=_("ion-button"),R=W(L),M=I(),D=_("ion-button"),F=W(B),g(e,"translucent",""),$(a,"position","fixed"),$(a,"left","calc(50% - 64px)"),$(a,"margin-right","auto"),$(a,"top","15%"),$(a,"font-size","128px"),$(a,"color","lightgray"),g(a,"name","bicycle"),g(h,"placeholder","email"),g(h,"type","text"),g(h,"required",""),g(h,"autofocus",""),g(d,"placeholder","password"),g(d,"type","password"),g(d,"required",""),g(w,"expand","block"),g(s,"lines","full")},m(N,A){T(N,e,A),u(e,t),u(t,i),u(i,r),T(N,l,A),T(N,a,A),T(N,c,A),T(N,s,A),P&&P.m(s,null),u(s,b),H&&H.m(s,null),u(s,p),u(s,v),u(v,h),n[9](h),u(s,m),u(s,y),u(y,d),n[10](d),u(s,f),O&&O.m(s,null),u(s,k),u(s,w),u(w,R),T(N,M,A),T(N,D,A),u(D,F),h.focus(),V||(Re=[U(d,"keypress",function(){et(n[0]?void 0:n[7])&&(n[0]?void 0:n[7]).apply(this,arguments)}),U(w,"click",n[6]),U(D,"click",n[12])],V=!0)},p(N,[A]){n=N,A&1&&o!==(o=n[0]?"Sign up":"Login")&&G(r,o),n[1]!==""?P?P.p(n,A):(P=Ne(n),P.c(),P.m(s,b)):P&&(P.d(1),P=null),n[0]?H?H.p(n,A):(H=Ue(n),H.c(),H.m(s,p)):H&&(H.d(1),H=null),n[0]?O?O.p(n,A):(O=$e(n),O.c(),O.m(s,k)):O&&(O.d(1),O=null),A&1&&L!==(L=n[0]?"Sign up":"Login")&&G(R,L),A&1&&B!==(B=n[0]?"Login instead":"Sign up instead")&&G(F,B)},i:E,o:E,d(N){N&&S(e),N&&S(l),N&&S(a),N&&S(c),N&&S(s),P&&P.d(),H&&H.d(),n[9](null),n[10](null),O&&O.d(),N&&S(M),N&&S(D),V=!1,ae(Re)}}}function yt(n,e,t){const i=tt();function o(){!c||!s||r&&!b||i("submit",{name:a?a.value:void 0,email:c.value,password:s.value,confirmPassword:b?b.value:void 0,signup:r})}let{signup:r=!1}=e,{errorNote:l=""}=e,a,c,s,b;function p(f){f.key==="Enter"&&o()}function v(f){ne[f?"unshift":"push"](()=>{a=f,t(2,a)})}function h(f){ne[f?"unshift":"push"](()=>{c=f,t(3,c)})}function m(f){ne[f?"unshift":"push"](()=>{s=f,t(4,s)})}function y(f){ne[f?"unshift":"push"](()=>{b=f,t(5,b)})}const d=()=>t(0,r=!r);return n.$$set=f=>{"signup"in f&&t(0,r=f.signup),"errorNote"in f&&t(1,l=f.errorNote)},[r,l,a,c,s,b,o,p,v,h,m,y,d]}class kt extends Y{constructor(e){super();Z(this,e,yt,wt,J,{signup:0,errorNote:1})}}const vt=(n,e)=>{const t=localStorage.getItem(n),i=pe(t?JSON.parse(t):e);return i.subscribe(o=>localStorage.setItem(n,o?JSON.stringify(o):"")),i},fe=pe(!1),K=pe(null),we=pe(null),de=vt("currentTrip",null),Tt=n=>{de.update(e=>e?(e.geopoints=[...e.geopoints,{timestamp:new Date().toISOString(),location:n}],e):null)},ye=n=>{if(!n.length)return 0;let e=0;for(let t=1;t<n.length-1;++t)e+=nt(n[t-1].location,n[t].location);return e},St=n=>{let e=n.geopoints.map(t=>({latitude:t.location.latitude,longitude:t.location.longitude})).reduce((t,i)=>({latitude:t.latitude+i.latitude,longitude:i.longitude+t.longitude}));return e.latitude/=n.geopoints.length,e.longitude/=n.geopoints.length,e},It={toFirestore:n=>({name:n.name,email:n.email,credits:n.credits,redeemedRewards:n.redeemedRewards}),fromFirestore:(n,e)=>{const t=n.data(e);return{name:t.name,email:t.email,credits:t.credits,redeemedRewards:t.redeemedRewards}}},Le={toFirestore:n=>({id:n.id,userEmail:n.userEmail,startTime:he.fromDate(n.startTime),endTime:n.endTime?he.fromDate(n.endTime):null,transportType:n.transportType,distance:n.distance,geopoints:n.geopoints}),fromFirestore:(n,e)=>{const t=n.data(e);return{id:t.id,userEmail:t.userEmail,startTime:t.startTime.toDate(),endTime:t.endTime?t.endTime.toDate():null,transportType:t.transportType,distance:t.distance,geopoints:t.geopoints}}},Je={toFirestore:n=>({id:n.id,name:n.name,description:n.description,price:n.price,provider:n.provider,expiration:he.fromDate(n.expiration),remainingUnits:n.remainingUnits}),fromFirestore:(n,e)=>{const t=n.data(e);return{id:t.id,name:t.name,description:t.description,price:t.price,provider:t.provider,expiration:t.expiration.toDate(),remainingUnits:t.remainingUnits}}},re=()=>it(),Ke=n=>Te(re(),"users",n).withConverter(It),Mt=n=>Te(re(),"trips",n.id).withConverter(Le),Lt=n=>Te(re(),"rewards",n.id).withConverter(Je),Rt=async n=>{const o=n,{redeemedRewards:e}=o,t=ge(o,["redeemedRewards"]),i=be(_e({},t),{redeemedRewards:e.map(r=>r.id)});await ve(Ke(n.email),i)},Ct=async n=>{await ve(Mt(n),n)},zt=async n=>{await ve(Lt(n),n)},Et=async n=>{const e=await ot(Ke(n));if(!e.exists())return null;const t=e.data(),a=t,{redeemedRewards:i}=a,o=ge(a,["redeemedRewards"]),r=await Dt(t.email),l=(await Qe()).filter(c=>(i||[]).includes(c.id));return be(_e({},o),{trips:r,redeemedRewards:l})},Dt=async n=>{const e=[];return(await Se(Ie(re(),"trips").withConverter(Le))).forEach(i=>i.exists()&&e.push(i.data())),e.filter(i=>i.userEmail===n)},Nt=async n=>{(await Se(Ie(re(),"trips").withConverter(Le))).forEach(t=>{t.exists()&&t.data().id===n&&rt(t.ref)})},Qe=async()=>{const n=[];return(await Se(Ie(re(),"rewards").withConverter(Je))).forEach(t=>t.exists()&&n.push(t.data())),n};var ie={fetchUser:Et,fetchAllRewards:Qe,updateUser:Rt,updateTrip:Ct,updateReward:zt,deleteTrip:Nt};function ke(n){switch(n){case"bicycle":return"bicycle";case"walk":return"walk";case"publicTransport":return"bus";default:return"walk"}}const{window:Ut}=lt;function Fe(n,e,t){const i=n.slice();return i[16]=e[t],i}function $t(n){let e,t,i,o,r=n[5],l=[];for(let a=0;a<r.length;a+=1)l[a]=Pe(Fe(n,r,a));return{c(){e=_("ion-fab"),t=_("ion-fab-button"),t.innerHTML='<ion-icon name="add"></ion-icon>',i=I(),o=_("ion-fab-list");for(let a=0;a<l.length;a+=1)l[a].c();g(o,"side","top"),g(e,"horizontal","center"),g(e,"vertical","bottom"),g(e,"slot","fixed")},m(a,c){T(a,e,c),u(e,t),u(e,i),u(e,o);for(let s=0;s<l.length;s+=1)l[s].m(o,null)},p(a,c){if(c&48){r=a[5];let s;for(s=0;s<r.length;s+=1){const b=Fe(a,r,s);l[s]?l[s].p(b,c):(l[s]=Pe(b),l[s].c(),l[s].m(o,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=r.length}},d(a){a&&S(e),Ze(l,a)}}}function Ft(n){let e,t,i;return{c(){e=_("ion-fab"),e.innerHTML='<ion-fab-button><ion-icon name="close"></ion-icon></ion-fab-button>',g(e,"horizontal","center"),g(e,"vertical","bottom"),g(e,"slot","fixed")},m(o,r){T(o,e,r),t||(i=U(e,"click",n[3]),t=!0)},p:E,d(o){o&&S(e),t=!1,i()}}}function Pe(n){let e,t,i,o,r,l;function a(){return n[6](n[16])}return{c(){e=_("ion-fab-button"),t=_("ion-icon"),o=I(),g(t,"name",i=ke(n[16]))},m(c,s){T(c,e,s),u(e,t),u(e,o),r||(l=U(e,"click",a),r=!0)},p(c,s){n=c},d(c){c&&S(e),r=!1,l()}}}function Pt(n){let e,t,i,o,r;function l(s,b){return s[0]?Ft:$t}let a=l(n),c=a(n);return{c(){e=_("ion-content"),c.c(),t=I(),i=_("div"),Me(i,"class","map svelte-vsoji2"),$(i,"height","100%"),$(i,"width","100%")},m(s,b){T(s,e,b),c.m(e,null),u(e,t),u(e,i),o||(r=[U(Ut,"resize",n[2]),Ye(n[1].call(null,i))],o=!0)},p(s,[b]){a===(a=l(s))&&c?c.p(s,b):(c.d(1),c=a(s),c&&(c.c(),c.m(e,t)))},i:E,o:E,d(s){s&&S(e),c.d(),o=!1,ae(r)}}}function Ht(n,e,t){let i,o;Q(n,de,w=>t(0,i=w)),Q(n,K,w=>t(12,o=w));let r=null,l=null,a=null,c=null;const s=async()=>{const w=await st.getCurrentPosition();return{lat:w.coords.latitude,lng:w.coords.longitude}},b=w=>(r=q.map(w,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(r),r.setView([45.504755,-73.612572],14),{destroy:()=>{r==null||r.remove(),r=null}}),p=()=>r==null?void 0:r.invalidateSize(),v=async w=>{!r||(a==null||a.removeFrom(r),l==null||l.removeFrom(r),c=q.circleMarker(w,{color:"red",weight:2,opacity:.7}),a=q.circleMarker(w,{color:"red",weight:2,opacity:.7}),l=q.polyline([w],{color:"red",weight:3,opacity:.5,smoothFactor:1}),c.addTo(r),a.addTo(r),l.addTo(r))},h=()=>{if(!r||!(i==null?void 0:i.geopoints.length))return;const w=i.geopoints.sort((L,R)=>L.timestamp<R.timestamp?-1:1).map(L=>[L.location.latitude,L.location.longitude]);a=q.circleMarker(w[0],{color:"red",weight:2,opacity:.7}),c=q.circleMarker(w[w.length-1],{color:"red",weight:2,opacity:.7}),l=q.polyline(w,{color:"red",weight:3,opacity:.5,smoothFactor:1}),a.addTo(r),c.addTo(r),l.addTo(r)};let m=null;const y=()=>{if(m&&(clearInterval(m),m=null),!i)return;const w=ye(i.geopoints),L={id:i.id,userEmail:i.userEmail,transportType:i.transportType,startTime:new Date(i.startTime),endTime:new Date,distance:w,geopoints:i.geopoints.map(({location:R,timestamp:M})=>({location:R,timestamp:M}))};ie.updateTrip(L),de.set(null),r&&(l==null||l.removeFrom(r),a==null||a.removeFrom(r),c==null||c.removeFrom(r)),K.update(R=>R?(R.credits+=Math.floor(.28*w/1e3),R.trips=[...R.trips,L],R):null)},d=async w=>{de.set({id:Date.now().toString(),userEmail:o.email,startTime:new Date().toISOString(),transportType:w,geopoints:[]});const L=await s();v(L),m=window.setInterval(async()=>{if(!i)return;const R=await s();Tt({latitude:R.lat,longitude:R.lng}),i.geopoints.length==0?v(R):l==null||l.addLatLng(R)},3e3)};return me(()=>{setTimeout(async()=>{const w=await s();r==null||r.setView(w),(i==null?void 0:i.geopoints.length)&&h(),p()},300)}),[i,b,p,y,d,["publicTransport","walk","bicycle"],w=>d(w)]}class Ot extends Y{constructor(e){super();Z(this,e,Ht,Pt,J,{})}}function At(n){let e,t,i,o=n[0].name+"",r,l,a,c=n[0].description+"",s,b,p,v,h=n[0].price+"",m,y,d,f,k,w,L=n[0].expiration?`Expires on ${n[0].expiration.toDateString()}`:"",R,M,D,B;return{c(){e=_("ion-card"),t=_("ion-card-header"),i=_("ion-card-title"),r=W(o),l=I(),a=_("ion-card-subtitle"),s=W(c),b=I(),p=_("ion-card-content"),v=W("Cost: "),m=W(h),y=I(),d=_("ion-icon"),f=I(),k=_("br"),w=I(),R=W(L),g(a,"class","sub svelte-aab9bb"),$(d,"color","green"),$(d,"font-size","16px"),$(d,"padding-left","3px"),g(d,"name","leaf-outline"),g(p,"class","content svelte-aab9bb"),g(e,"class",M=De(n[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")},m(F,V){T(F,e,V),u(e,t),u(t,i),u(i,r),u(t,l),u(t,a),u(a,s),u(e,b),u(e,p),u(p,v),u(p,m),u(p,y),u(p,d),u(p,f),u(p,k),u(p,w),u(p,R),D||(B=U(e,"click",n[3]),D=!0)},p(F,[V]){V&1&&o!==(o=F[0].name+"")&&G(r,o),V&1&&c!==(c=F[0].description+"")&&G(s,c),V&1&&h!==(h=F[0].price+"")&&G(m,h),V&1&&L!==(L=F[0].expiration?`Expires on ${F[0].expiration.toDateString()}`:"")&&G(R,L),V&2&&M!==(M=De(F[1]?"redeemed":"notRedeemed")+" svelte-aab9bb")&&g(e,"class",M)},i:E,o:E,d(F){F&&S(e),D=!1,B()}}}function Wt(n,e,t){let i;Q(n,K,s=>t(4,i=s));let{reward:o}=e,r=(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1;function l(){!i||a()||!o.remainingUnits||i.credits<o.price||(K.update(s=>s&&(t(1,r=!0),s.credits-=o.price,s.redeemedRewards=[...s.redeemedRewards,o],s)),t(0,o.remainingUnits--,o))}function a(){return(i==null?void 0:i.redeemedRewards.findIndex(s=>s.id===o.id))!==-1}const c=()=>l();return n.$$set=s=>{"reward"in s&&t(0,o=s.reward)},[o,r,l,c]}class qt extends Y{constructor(e){super();Z(this,e,Wt,At,J,{reward:0})}}function He(n,e,t){const i=n.slice();return i[2]=e[t],i}function Oe(n){let e,t,i=n[1],o=[];for(let l=0;l<i.length;l+=1)o[l]=Ae(He(n,i,l));const r=l=>z(o[l],1,1,()=>{o[l]=null});return{c(){for(let l=0;l<o.length;l+=1)o[l].c();e=ce()},m(l,a){for(let c=0;c<o.length;c+=1)o[c].m(l,a);T(l,e,a),t=!0},p(l,a){if(a&2){i=l[1];let c;for(c=0;c<i.length;c+=1){const s=He(l,i,c);o[c]?(o[c].p(s,a),C(o[c],1)):(o[c]=Ae(s),o[c].c(),C(o[c],1),o[c].m(e.parentNode,e))}for(ee(),c=i.length;c<o.length;c+=1)r(c);te()}},i(l){if(!t){for(let a=0;a<i.length;a+=1)C(o[a]);t=!0}},o(l){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)z(o[a]);t=!1},d(l){Ze(o,l),l&&S(e)}}}function Ae(n){let e,t;return e=new qt({props:{reward:n[2]}}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),t=!0},p(i,o){const r={};o&2&&(r.reward=i[2]),e.$set(r)},i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){x(e,i)}}}function Bt(n){var y;let e,t,i,o,r,l,a,c=((y=n[0])==null?void 0:y.credits)+"",s,b,p,v,h,m=n[1]&&Oe(n);return{c(){e=_("ion-header"),e.innerHTML="<ion-toolbar><ion-title>Rewards</ion-title></ion-toolbar>",t=I(),i=_("ion-content"),o=_("ion-list"),r=_("ion-list-header"),l=_("h2"),a=W("You have "),s=W(c),b=I(),p=_("ion-icon"),v=I(),m&&m.c(),g(e,"translucent",""),$(p,"color","green"),$(p,"font-size","32px"),$(p,"padding-left","3px"),g(p,"name","leaf-outline")},m(d,f){T(d,e,f),T(d,t,f),T(d,i,f),u(i,o),u(o,r),u(r,l),u(l,a),u(l,s),u(r,b),u(r,p),u(o,v),m&&m.m(o,null),h=!0},p(d,[f]){var k;(!h||f&1)&&c!==(c=((k=d[0])==null?void 0:k.credits)+"")&&G(s,c),d[1]?m?(m.p(d,f),f&2&&C(m,1)):(m=Oe(d),m.c(),C(m,1),m.m(o,null)):m&&(ee(),z(m,1,1,()=>{m=null}),te())},i(d){h||(C(m),h=!0)},o(d){z(m),h=!1},d(d){d&&S(e),d&&S(t),d&&S(i),m&&m.d()}}}function Vt(n,e,t){let i,o;return Q(n,K,r=>t(0,i=r)),Q(n,we,r=>t(1,o=r)),[i,o]}class Gt extends Y{constructor(e){super();Z(this,e,Vt,Bt,J,{})}}function Yt(n){let e,t,i,o,r,l,a,c;return{c(){e=_("ion-list"),t=_("ion-item"),t.innerHTML=`Logout
        <ion-icon name="log-out-outline" slot="end"></ion-icon>`,i=I(),o=_("ion-item"),o.innerHTML=`about
        <ion-icon name="information-circle-outline" slot="end"></ion-icon>`,r=I(),l=_("ion-item"),l.innerHTML=`GitHub Repo
        <ion-icon name="logo-github" slot="end"></ion-icon>`,g(t,"button",""),g(o,"button",""),g(l,"lines","none"),g(l,"button",""),g(e,"lines","n")},m(s,b){T(s,e,b),u(e,t),u(e,i),u(e,o),u(e,r),u(e,l),a||(c=[U(t,"click",n[1]),U(o,"click",n[2]),U(l,"click",n[3])],a=!0)},p:E,i:E,o:E,d(s){s&&S(e),a=!1,ae(c)}}}function Zt(n){let e=document.querySelector("ion-popover");const t=l=>{e==null||e.dismiss(l)};return[t,()=>{t("logout")},()=>{t("about")},()=>{t("github")}]}class Jt extends Y{constructor(e){super();Z(this,e,Zt,Yt,J,{})}}const Kt=function(n){return document.createElement(n).constructor!==HTMLElement},Qt=(n,e)=>{Kt(n)||ct(n,e,[])},jt=(n,e,t,i)=>(Qt(e,t),at.create({component:e,event:n,componentProps:i}).then(o=>(o.present(),o.onWillDismiss()))),Xt=()=>!!oe().currentUser,xt=()=>{var n;return((n=oe().currentUser)==null?void 0:n.email)||null},en=async(n,e)=>{try{return await ut(oe(),n,e),!0}catch(t){return console.log("Failed to login"),console.log(t),!1}},tn=()=>oe().signOut(),nn=async(n,e,t)=>{try{return await ft(oe(),e,t),await ie.updateUser({email:e,name:n,credits:100,redeemedRewards:[],trips:[]}),!0}catch(i){return console.log("Failed to sign up"),console.log(i),!1}};var se={logout:tn,login:en,getCurrentUser:xt,isLoggedIn:Xt,signUp:nn};function on(n){let e,t,i;return{c(){e=_("div"),Me(e,"class","map svelte-lgm8ca"),$(e,"height","100%"),$(e,"width","100%")},m(o,r){T(o,e,r),t||(i=[U(window,"resize",n[1]),Ye(n[0].call(null,e))],t=!0)},p:E,i:E,o:E,d(o){o&&S(e),t=!1,ae(i)}}}function rn(n,e,t){let{trip:i}=e,o=null,r=null,l=null,a=null;const c=p=>(o=q.map(p,{preferCanvas:!0}),q.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery \xA9 <a href="https://www.mapbox.com/">Mapbox</a>',maxZoom:20,minZoom:1,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:"pk.eyJ1IjoicmVkNWg0ZDB3IiwiYSI6ImNrems4bzhzMzRrcG4yeHByYTgwN2draHcifQ.356a0A2cfoy3zrhq-IW_rA"}).addTo(o),o.setView([45.504755,-73.612572],14),{destroy:()=>{o==null||o.remove(),o=null}}),s=()=>o==null?void 0:o.invalidateSize(),b=()=>{if(!o)return;const p=i.geopoints.sort((v,h)=>v.timestamp<h.timestamp?-1:1).map(v=>[v.location.latitude,v.location.longitude]);l=q.circleMarker(p[0],{color:"red",weight:2,opacity:.7}),a=q.circleMarker(p[p.length-1],{color:"red",weight:2,opacity:.7}),r=q.polyline(p,{color:"red",weight:3,opacity:.5,smoothFactor:1}),l.addTo(o),a.addTo(o),r.addTo(o)};return me(()=>{setTimeout(async()=>{if(i){console.log(i);var p=St(i);o==null||o.setView([p.latitude,p.longitude]),b()}s()},1e3)}),n.$$set=p=>{"trip"in p&&t(2,i=p.trip)},[c,s,i]}class ln extends Y{constructor(e){super();Z(this,e,rn,on,J,{trip:2})}}function We(n){let e,t,i;return t=new ln({props:{trip:n[0]}}),{c(){e=_("ion-modal"),j(t.$$.fragment),g(e,"is-open","")},m(o,r){T(o,e,r),X(t,e,null),i=!0},p(o,r){const l={};r&1&&(l.trip=o[0]),t.$set(l)},i(o){i||(C(t.$$.fragment,o),i=!0)},o(o){z(t.$$.fragment,o),i=!1},d(o){o&&S(e),x(t)}}}function sn(n){let e,t,i,o,r,l=ye(n[0].geopoints).toLocaleString(void 0,{maximumFractionDigits:0})+" m",a,c,s,b,p,v,h,m,y,d,f=n[3]&&We(n);return{c(){e=_("ion-item"),t=_("ion-icon"),o=I(),r=_("ion-label"),a=W(l),c=I(),s=_("ion-button"),b=W("Delete"),v=I(),f&&f.c(),h=ce(),g(t,"name",i=ke(n[0].transportType)),g(t,"slot","start"),s.hidden=p=!n[1]},m(k,w){T(k,e,w),u(e,t),u(e,o),u(e,r),u(r,a),u(e,c),u(e,s),u(s,b),n[7](e),T(k,v,w),f&&f.m(k,w),T(k,h,w),m=!0,y||(d=[U(r,"click",n[5]),U(s,"click",n[6])],y=!0)},p(k,[w]){(!m||w&1&&i!==(i=ke(k[0].transportType)))&&g(t,"name",i),(!m||w&1)&&l!==(l=ye(k[0].geopoints).toLocaleString(void 0,{maximumFractionDigits:0})+" m")&&G(a,l),(!m||w&2&&p!==(p=!k[1]))&&(s.hidden=p),k[3]?f?(f.p(k,w),w&8&&C(f,1)):(f=We(k),f.c(),C(f,1),f.m(h.parentNode,h)):f&&(ee(),z(f,1,1,()=>{f=null}),te())},i(k){m||(C(f),m=!0)},o(k){z(f),m=!1},d(k){k&&S(e),n[7](null),k&&S(v),f&&f.d(k),k&&S(h),y=!1,ae(d)}}}function an(n,e,t){let{trip:i}=e,{editable:o=!1}=e,r;function l(){ie.deleteTrip(i.id)}let a=!1;function c(p){t(3,a=!0)}const s=()=>{var p;l(),(p=r==null?void 0:r.parentNode)==null||p.removeChild(r)};function b(p){ne[p?"unshift":"push"](()=>{r=p,t(2,r)})}return n.$$set=p=>{"trip"in p&&t(0,i=p.trip),"editable"in p&&t(1,o=p.editable)},[i,o,r,a,l,c,s,b]}class cn extends Y{constructor(e){super();Z(this,e,an,sn,J,{trip:0,editable:1})}}function qe(n,e,t){const i=n.slice();return i[6]=e[t],i}function un(n){let e,t,i,o,r,l;return{c(){e=_("ion-item"),t=_("ion-label"),t.textContent="Failed to load user",i=I(),o=_("ion-button"),o.textContent="Go back to login page",g(o,"slot","end"),g(o,"fill","outline")},m(a,c){T(a,e,c),u(e,t),u(e,i),u(e,o),r||(l=U(o,"click",n[5]),r=!0)},p:E,i:E,o:E,d(a){a&&S(e),r=!1,l()}}}function fn(n){let e,t,i,o,r,l=[],a=new Map,c,s,b,p,v,h=n[1].trips;const m=d=>d[6].id;for(let d=0;d<h.length;d+=1){let f=qe(n,h,d),k=m(f);a.set(k,l[d]=Be(k,f))}let y=!n[1].trips.length&&Ve();return{c(){e=_("ion-list-header"),t=_("ion-label"),t.textContent="Trips",i=I(),o=_("ion-button"),o.textContent="Edit",r=I();for(let d=0;d<l.length;d+=1)l[d].c();c=I(),y&&y.c(),s=ce()},m(d,f){T(d,e,f),u(e,t),u(e,i),u(e,o),T(d,r,f);for(let k=0;k<l.length;k+=1)l[k].m(d,f);T(d,c,f),y&&y.m(d,f),T(d,s,f),b=!0,p||(v=U(o,"click",n[4]),p=!0)},p(d,f){f&3&&(h=d[1].trips,ee(),l=pt(l,f,m,1,d,h,a,c.parentNode,mt,Be,c,qe),te()),d[1].trips.length?y&&(y.d(1),y=null):y||(y=Ve(),y.c(),y.m(s.parentNode,s))},i(d){if(!b){for(let f=0;f<h.length;f+=1)C(l[f]);b=!0}},o(d){for(let f=0;f<l.length;f+=1)z(l[f]);b=!1},d(d){d&&S(e),d&&S(r);for(let f=0;f<l.length;f+=1)l[f].d(d);d&&S(c),y&&y.d(d),d&&S(s),p=!1,v()}}}function Be(n,e){let t,i,o;return i=new cn({props:{editable:e[0],trip:e[6]}}),{key:n,first:null,c(){t=ce(),j(i.$$.fragment),this.first=t},m(r,l){T(r,t,l),X(i,r,l),o=!0},p(r,l){e=r;const a={};l&1&&(a.editable=e[0]),l&2&&(a.trip=e[6]),i.$set(a)},i(r){o||(C(i.$$.fragment,r),o=!0)},o(r){z(i.$$.fragment,r),o=!1},d(r){r&&S(t),x(i,r)}}}function Ve(n){let e;return{c(){e=_("ion-item"),e.innerHTML='<ion-label color="medium">You don&#39;t have any trips yets</ion-label>',g(e,"lines","none")},m(t,i){T(t,e,i)},d(t){t&&S(e)}}}function dn(n){let e,t,i,o,r,l,a=(n[1]?n[1].name:"Profile")+"",c,s,b,p,v,h,m,y,d,f,k;const w=[fn,un],L=[];function R(M,D){return M[1]?0:1}return m=R(n),y=L[m]=w[m](n),{c(){e=_("ion-header"),t=_("ion-toolbar"),i=_("ion-buttons"),o=_("ion-button"),o.innerHTML='<ion-icon slot="icon-only" ios="ellipsis-horizontal" md="ellipsis-vertical"></ion-icon>',r=I(),l=_("ion-title"),c=W(a),s=I(),b=_("ion-content"),p=_("div"),v=I(),h=_("ion-list"),y.c(),g(i,"slot","primary"),g(e,"translucent",""),Me(p,"class","summary-map")},m(M,D){T(M,e,D),u(e,t),u(t,i),u(i,o),u(t,r),u(t,l),u(l,c),T(M,s,D),T(M,b,D),u(b,p),u(b,v),u(b,h),L[m].m(h,null),d=!0,f||(k=U(o,"click",n[2]),f=!0)},p(M,[D]){(!d||D&2)&&a!==(a=(M[1]?M[1].name:"Profile")+"")&&G(c,a);let B=m;m=R(M),m===B?L[m].p(M,D):(ee(),z(L[B],1,1,()=>{L[B]=null}),te(),y=L[m],y?y.p(M,D):(y=L[m]=w[m](M),y.c()),C(y,1),y.m(h,null))},i(M){d||(C(y),d=!0)},o(M){z(y),d=!1},d(M){M&&S(e),M&&S(s),M&&S(b),L[m].d(),f=!1,k()}}}function pn(n,e,t){let i;Q(n,K,s=>t(1,i=s));let o=!1;function r(s){jt(s,"popover-extra",Jt,{}).then(async b=>{switch(b.data){case"logout":await se.logout();break;case"github":await dt.open({url:"http://github.com/marr11317/bhackcycle"})}})}function l(){t(0,o=!o)}return[o,i,r,l,()=>l(),()=>se.logout()]}class mn extends Y{constructor(e){super();Z(this,e,pn,dn,J,{})}}function _n(n){let e,t,i,o,r,l,a,c,s,b,p,v,h;return o=new Ot({}),a=new Gt({}),b=new mn({}),{c(){e=_("ion-app"),t=_("ion-tabs"),i=_("ion-tab"),j(o.$$.fragment),r=I(),l=_("ion-tab"),j(a.$$.fragment),c=I(),s=_("ion-tab"),j(b.$$.fragment),p=I(),v=_("ion-tab-bar"),v.innerHTML=`<ion-tab-button tab="map"><ion-label>Map</ion-label> 
        <ion-icon name="bicycle-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="rewards"><ion-label>Rewards</ion-label> 
        <ion-icon name="trophy-outline"></ion-icon></ion-tab-button> 
      <ion-tab-button tab="profile"><ion-label>profile</ion-label> 
        <ion-icon name="analytics-outline"></ion-icon></ion-tab-button>`,g(i,"tab","map"),g(l,"tab","rewards"),g(s,"tab","profile"),g(v,"slot","bottom")},m(m,y){T(m,e,y),u(e,t),u(t,i),X(o,i,null),u(t,r),u(t,l),X(a,l,null),u(t,c),u(t,s),X(b,s,null),u(t,p),u(t,v),h=!0},p:E,i(m){h||(C(o.$$.fragment,m),C(a.$$.fragment,m),C(b.$$.fragment,m),h=!0)},o(m){z(o.$$.fragment,m),z(a.$$.fragment,m),z(b.$$.fragment,m),h=!1},d(m){m&&S(e),x(o),x(a),x(b)}}}function bn(n,e,t){let i,o;return Q(n,we,r=>t(0,i=r)),Q(n,K,r=>t(1,o=r)),me(async()=>{const r=await ie.fetchUser(se.getCurrentUser());le(K,o=r,o);const l=await ie.fetchAllRewards();le(we,i=l,i)}),K.subscribe(async r=>{r&&await ie.updateUser(r)}),[]}class gn extends Y{constructor(e){super();Z(this,e,bn,_n,J,{})}}function Ge(n){let e,t,i,o;const r=[wn,hn],l=[];function a(c,s){return c[3]?1:0}return e=a(n),t=l[e]=r[e](n),{c(){t.c(),i=ce()},m(c,s){l[e].m(c,s),T(c,i,s),o=!0},p(c,s){let b=e;e=a(c),e===b?l[e].p(c,s):(ee(),z(l[b],1,1,()=>{l[b]=null}),te(),t=l[e],t?t.p(c,s):(t=l[e]=r[e](c),t.c()),C(t,1),t.m(i.parentNode,i))},i(c){o||(C(t),o=!0)},o(c){z(t),o=!1},d(c){l[e].d(c),c&&S(i)}}}function hn(n){let e,t;return e=new gn({}),{c(){j(e.$$.fragment)},m(i,o){X(e,i,o),t=!0},p:E,i(i){t||(C(e.$$.fragment,i),t=!0)},o(i){z(e.$$.fragment,i),t=!1},d(i){x(e,i)}}}function wn(n){let e,t,i;function o(l){n[5](l)}let r={errorNote:n[2]};return n[1]!==void 0&&(r.signup=n[1]),e=new kt({props:r}),ne.push(()=>_t(e,"signup",o)),e.$on("submit",n[4]),{c(){j(e.$$.fragment)},m(l,a){X(e,l,a),i=!0},p(l,a){const c={};a&4&&(c.errorNote=l[2]),!t&&a&2&&(t=!0,c.signup=l[1],bt(()=>t=!1)),e.$set(c)},i(l){i||(C(e.$$.fragment,l),i=!0)},o(l){z(e.$$.fragment,l),i=!1},d(l){x(e,l)}}}function yn(n){let e,t,i=n[0]&&Ge(n);return{c(){e=_("ion-app"),i&&i.c()},m(o,r){T(o,e,r),i&&i.m(e,null),t=!0},p(o,[r]){o[0]?i?(i.p(o,r),r&1&&C(i,1)):(i=Ge(o),i.c(),C(i,1),i.m(e,null)):i&&(ee(),z(i,1,1,()=>{i=null}),te())},i(o){t||(C(i),t=!0)},o(o){z(i),t=!1},d(o){o&&S(e),i&&i.d()}}}function kn(n,e,t,i,o){return o&&t!==i?"Passwords do not match":""}function vn(n,e,t){let i;Q(n,fe,s=>t(3,i=s)),me(()=>{gt({apiKey:"AIzaSyClWb9snAaau0p3gWecoCVMywUwIKgP7Eo",authDomain:"hackatown-2022.firebaseapp.com",projectId:"hackatown-2022",storageBucket:"hackatown-2022.appspot.com",messagingSenderId:"410454368204",appId:"1:410454368204:web:16fa9750c1621761564769"}),oe().onAuthStateChanged(s=>{le(fe,i=!!s,i),t(0,o=!0)})});let o=!1,r=!1,l="";async function a(s){const{name:b,email:p,password:v,confirmPassword:h,signup:m}=s.detail,y=kn(b,p,v,h,m);if(y!=""){t(2,l=y);return}m?await se.signUp(b,p,v)?(t(2,l=""),le(fe,i=!0,i)):t(2,l="Signup failed"):await se.login(p,v)?(t(2,l=""),le(fe,i=!0,i)):t(2,l="Invalid email or password")}function c(s){r=s,t(1,r)}return[o,r,l,i,a,c]}class Tn extends Y{constructor(e){super();Z(this,e,vn,yn,J,{})}}new Tn({target:document.body});
